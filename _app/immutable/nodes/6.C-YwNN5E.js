import"../chunks/DsnmJJEf.js";import"../chunks/BArfBHBa.js";import{o as me}from"../chunks/D6F5klbK.js";import{O as fe,av as he,b as e,aw as H,ax as be,ay as P,aD as K,a as T,az as ye,s as i,K as m,aA as v,aB as n,u as x,aC as s,aE as ge,aW as je,aX as ke}from"../chunks/JwfWP7l2.js";import{e as g,s as C}from"../chunks/D73Aelo1.js";import{i as ae}from"../chunks/VnCXLVbX.js";import{e as _e,i as we}from"../chunks/CDfcZW8-.js";import{A as J,r as xe}from"../chunks/Ce2Y3TL0.js";import{s as te}from"../chunks/DpzZfCb8.js";import{b as oe}from"../chunks/BswAZx1J.js";import{i as Ee}from"../chunks/V6Rb_VSp.js";import{b as Se}from"../chunks/DUyrxhzh.js";function $e(_){return function(...f){var r=f[0];return r.stopPropagation(),_?.apply(this,f)}}function Te(_,f){var r=_.$$events?.[f.type],u=fe(r)?r.slice():r==null?[]:[r];for(var j of u)j.call(this,f)}var Ce=P("<div> </div>"),Pe=P('<span class="error svelte-1objkjl"> </span>'),Ae=P('<div class="modal-overlay svelte-1objkjl" role="dialog" aria-modal="true" aria-labelledby="congrats-title"><div class="modal-card svelte-1objkjl"><div class="modal-head svelte-1objkjl"><div class="modal-icon svelte-1objkjl" aria-hidden="true"><svg viewBox="0 0 24 24" width="26" height="26"><rect x="3" y="7" width="18" height="12" rx="6" fill="currentColor" opacity=".9"></rect><rect x="9" y="3" width="6" height="4" rx="2" fill="#0b1240" opacity=".08"></rect><circle cx="9" cy="13" r="1.6" fill="#0b1240"></circle><circle cx="15" cy="13" r="1.6" fill="#0b1240"></circle></svg></div> <h2 id="congrats-title" class="modal-title svelte-1objkjl">¬°100% alcanzado!</h2></div> <p class="modal-body svelte-1objkjl">¬øListo para ir a revisar el resultado de tu evaluaci√≥n?</p> <div class="modal-actions svelte-1objkjl"><button class="btn-ghost svelte-1objkjl" type="button">Volver</button> <button class="btn-primary svelte-1objkjl" type="button">S√≠</button></div></div></div>'),Ie=P('<div class="page svelte-1objkjl"><div class="container svelte-1objkjl"><section class="hero svelte-1objkjl"><div><h1 class="svelte-1objkjl">Evaluaci√≥n √©tica inicial</h1> <p class="svelte-1objkjl">A trav√©s de esta conversaci√≥n, te ayudar√© a definir la situaci√≥n de tu proyecto. Usaremos lo que compartas para generar una autoevaluaci√≥n y una gu√≠a de revisi√≥n √©tica √∫til y adaptada a tu caso. Te har√© preguntas cortas y te avisar√© cuando tengamos lo m√≠nimo para analizar.</p></div> <div style="display:flex; gap:8px; align-items:center;"><span> </span></div></section> <section class="card pad svelte-1objkjl"><div class="label svelte-1objkjl">Nombre de la evaluaci√≥n</div> <input class="input svelte-1objkjl" placeholder="Ej.: Reportaje sobre acceso a la justicia en zonas rurales"/> <div class="hint svelte-1objkjl">Se autogenera al iniciar; puedes cambiarlo en cualquier momento.</div></section> <div class="layout svelte-1objkjl"><section class="card chat svelte-1objkjl" style="overflow:hidden"><div class="chathead svelte-1objkjl"><svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true" style="vertical-align:middle; margin-right:6px;"><rect x="4" y="7" width="16" height="10" rx="4" fill="#e9bf3c" stroke="#374151" stroke-width="1.5"></rect><rect x="9" y="2" width="6" height="4" rx="2" fill="#fff" stroke="#374151" stroke-width="1"></rect><circle cx="8" cy="12" r="1.5" fill="#374151"></circle><circle cx="16" cy="12" r="1.5" fill="#374151"></circle><rect x="10" y="15" width="4" height="2" rx="1" fill="#374151"></rect><line x1="2" y1="10" x2="4" y2="10" stroke="#374151" stroke-width="1"></line><line x1="20" y1="10" x2="22" y2="10" stroke="#374151" stroke-width="1"></line></svg> Tutor IA</div> <div id="chatbox" class="chatbody svelte-1objkjl"></div> <div class="composer svelte-1objkjl"><textarea class="textarea svelte-1objkjl" placeholder="Comenta de qu√© trata tu tarea para recibir una mejor gu√≠a‚Ä¶ (Shift+Enter para salto de l√≠nea)"></textarea> <button class="btn svelte-1objkjl"> </button></div></section></div> <div class="footer svelte-1objkjl"><div></div> <div style="display:flex; gap:8px; align-items:center;"><!> <button class="btn primary svelte-1objkjl">Continuar con evaluaci√≥n √©tica</button></div></div></div> <!></div>');function Ue(_,f){he(f,!1);let r=m(null),u=m(""),j=m(""),d=m([]),k=m(!1),b=m(""),A=null,I="",R="",p=m(!1);const w=()=>!!(A&&(I?.trim().length??0)>=20);function ie(a,t){i(d,[...e(d),{role:a,content:t,ts:Date.now()}]),queueMicrotask(()=>{const o=document.getElementById("chatbox");o&&(o.scrollTop=o.scrollHeight)})}me(async()=>{try{const a=localStorage.getItem("access_token")||"",t=await fetch(`${J}/intake/new_chat`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({})});if(!t.ok)throw new Error(await t.text());const o=await t.json();i(r,o.draft_id),i(u,o.default_name||`Evaluaci√≥n ${new Date().toLocaleDateString()}-${Date.now()}-${Math.floor(Math.random()*1e4)}`),ie("assistant",`üëã Hola, soy tu Tutor IA. A trav√©s de esta conversaci√≥n, te ayudar√© a definir claramente la situaci√≥n de tu proyecto. Usaremos lo que compartas para generar una autoevaluaci√≥n y una gu√≠a de revisi√≥n √©tica adaptada a tu caso.

Cu√©ntame brevemente tu objetivo y en qu√© etapa del proyecto te encuentras. Para orientarte mejor, estas son las etapas que suelo manejar:
 - Creaci√≥n de Contenidos
 - Revisi√≥n y Validaci√≥n
 - Publicaci√≥n y Difusi√≥n
 - Posproducci√≥n
 - Monitoreo

Te har√© algunas preguntas para entender mejor tu contexto. Cuando consideres que has entregado toda la informaci√≥n relevante, puedes hacer clic en 'Continuar con evaluaci√≥n √©tica'. ¬°Empecemos!`)}catch(a){i(b,a?.message||"No se pudo iniciar el chat.")}});async function re(a,t,o=12){e(d)[t]?.role!=="assistant"&&(i(d,[...e(d),{role:"assistant",content:"",ts:Date.now()}]),t=e(d).length-1);for(let l=0;l<a.length;l++)ke(d,e(d)[t].content+=a[l]),i(d,[...e(d)]),queueMicrotask(()=>{const c=document.getElementById("chatbox");c&&(c.scrollTop=c.scrollHeight)}),await new Promise(c=>setTimeout(c,o))}async function U(){const a=e(j).trim();if(!(!a||!e(r))){i(b,""),i(d,[...e(d),{role:"user",content:a,ts:Date.now()}]),i(j,""),queueMicrotask(()=>{const t=document.getElementById("chatbox");t&&(t.scrollTop=t.scrollHeight)});try{i(k,!0);const t=localStorage.getItem("access_token")||"",o=await fetch(`${J}/intake/${e(r)}/message`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({message:a,current_name:e(u)||null})});if(!o.ok)throw new Error(await o.text());const l=await o.json();await re(l.reply,e(d).length);const c=l.extracted||{};c.etapa&&(A=c.etapa),c.descripcion&&(I=c.descripcion),c.herramientas&&(R=c.herramientas),typeof l.ready=="boolean"&&i(p,l.ready)}catch(t){i(b,t?.message||"Error al enviar el mensaje.")}finally{i(k,!1)}}}async function V(){if(!w()){i(b,"Necesito al menos la etapa y una descripci√≥n breve (‚â• 20 chars).");return}const a={etapa:A,descripcion:I.trim(),herramientas:R.trim(),nombre:e(u)&&e(u).trim()?e(u).trim():`Evaluaci√≥n ${new Date().toLocaleDateString()}`,draft_id:e(r)};try{const t=localStorage.getItem("access_token")||"",o=await fetch(`${J}/evaluaciones/new`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},credentials:"include",mode:"cors",body:JSON.stringify(a)});if(!o.ok)throw new Error(await o.text());const l=await o.json();window.location.href=`${Se}/evaluaciones/${l._id}/checklist`}catch(t){i(b,t?.message||"Error al crear la evaluaci√≥n.")}}let h=m(!1),y=m(!1);const B=a=>`ethics_ready_popup_${a??"new"}`;function E(){i(h,!1),i(y,!0),e(r)&&localStorage.setItem(B(e(r)),"1")}async function se(){await V(),E()}typeof window<"u"&&window.addEventListener("keydown",a=>{a.key==="Escape"&&e(h)&&E()}),H(()=>(e(r),e(y)),()=>{e(r)&&!e(y)&&i(y,localStorage.getItem(B(e(r)))==="1")}),H(()=>(e(p),e(r),e(y),e(h)),()=>{(e(p)||w())&&e(r)&&!e(y)&&!e(h)&&(i(h,!0),i(y,!0),localStorage.setItem(B(e(r)),"1"))}),H(()=>e(h),()=>{typeof document<"u"&&(document.body.style.overflow=e(h)?"hidden":"")}),be(),Ee();var D=Ie(),q=n(D),O=n(q),G=v(n(O),2),z=n(G),ne=n(z,!0);s(z),s(G),s(O);var M=v(O,2),W=v(n(M),2);xe(W),ge(2),s(M);var N=v(M,2),X=n(N),L=v(n(X),2);_e(L,5,()=>e(d),we,(a,t)=>{var o=Ce(),l=n(o,!0);s(o),K(()=>{te(o,1,`msg ${e(t),x(()=>e(t).role)??""}`,"svelte-1objkjl"),C(l,(e(t),x(()=>e(t).content)))}),T(a,o)}),s(L);var Y=v(L,2),S=n(Y);je(S);var $=v(S,2),le=n($,!0);s($),s(Y),s(X),s(N);var F=v(N,2),Q=v(n(F),2),Z=n(Q);{var ce=a=>{var t=Pe(),o=n(t,!0);s(t),K(()=>C(o,e(b))),T(a,t)};ae(Z,a=>{e(b)&&a(ce)})}var ee=v(Z,2);s(Q),s(F),s(q);var de=v(q,2);{var ve=a=>{var t=Ae(),o=n(t),l=v(n(o),4),c=n(l),ue=v(c,2);s(l),s(o),s(t),g("click",c,E),g("click",ue,se),g("click",o,$e(function(pe){Te.call(this,f,pe)})),g("click",t,E),T(a,t)};ae(de,a=>{e(h)&&a(ve)})}s(D),K((a,t,o)=>{te(z,1,`pill ${a??""}`,"svelte-1objkjl"),C(ne,t),$.disabled=!e(r)||e(k),C(le,e(k)?"Generando‚Ä¶":"Enviar"),ee.disabled=o},[()=>(e(p),x(()=>e(p)||w()?"green":"yellow")),()=>(e(p),x(()=>e(p)||w()?"Listo para analizar":"A√∫n faltan datos")),()=>(e(k),e(p),x(()=>e(k)||!e(p)&&!w()))]),oe(W,()=>e(u),a=>i(u,a)),oe(S,()=>e(j),a=>i(j,a)),g("keydown",S,a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),U())}),g("click",$,U),g("click",ee,V),T(_,D),ye()}export{Ue as component};
