import"../chunks/DsnmJJEf.js";import"../chunks/uehYZzkF.js";import{o as $e}from"../chunks/CFuMONhm.js";import{av as Se,ay as f,aD as w,b as a,a as m,az as De,aA as o,aB as i,O as d,s as l,aC as r,aE as Te,aG as Ce,aH as Ae,aF as re}from"../chunks/oOC6CyD3.js";import{e as G,s as u}from"../chunks/Bj18uxIO.js";import{i as A}from"../chunks/C2ciDzbX.js";import{e as Pe,i as Be}from"../chunks/lE9yVeNz.js";import{A as K,r as qe}from"../chunks/CdqO7dcH.js";import{s as E}from"../chunks/DbCbTNl9.js";import{b as ie}from"../chunks/BqAu88Dq.js";import{i as Ie}from"../chunks/BBFBmJEc.js";import{b as Oe}from"../chunks/DeN2zgxv.js";var ze=f("<div> </div>"),He=f('<p class="meta-text svelte-1objkjl"> </p>'),Me=f('<p class="meta-empty svelte-1objkjl">A√∫n no hay descripci√≥n.</p>'),Ne=f('<p class="meta-text svelte-1objkjl"> </p>'),Je=f('<p class="meta-empty svelte-1objkjl">Sin herramientas indicadas.</p>'),Le=f('<span class="error svelte-1objkjl"> </span>'),Ge=f('<div class="page svelte-1objkjl"><div class="container svelte-1objkjl"><section class="hero svelte-1objkjl"><div><h1 class="svelte-1objkjl">Evaluaci√≥n √©tica inicial</h1> <p class="svelte-1objkjl">Conversemos; har√© preguntas cortas y te avisar√© cuando tengamos lo m√≠nimo para analizar.</p></div> <div style="display:flex; gap:8px; align-items:center;"><span> </span></div></section> <section class="card pad svelte-1objkjl"><div class="label svelte-1objkjl">Nombre de la evaluaci√≥n</div> <input class="input svelte-1objkjl" placeholder="Ej.: Reportaje sobre acceso a la justicia en zonas rurales"/> <div class="hint svelte-1objkjl">Se autogenera al iniciar; puedes cambiarlo en cualquier momento.</div></section> <div class="layout svelte-1objkjl"><section class="card chat svelte-1objkjl" style="overflow:hidden"><div class="chathead svelte-1objkjl"><svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true" style="vertical-align:middle; margin-right:6px;"><rect x="4" y="7" width="16" height="10" rx="4" fill="#e9bf3c" stroke="#374151" stroke-width="1.5"></rect><rect x="9" y="2" width="6" height="4" rx="2" fill="#fff" stroke="#374151" stroke-width="1"></rect><circle cx="8" cy="12" r="1.5" fill="#374151"></circle><circle cx="16" cy="12" r="1.5" fill="#374151"></circle><rect x="10" y="15" width="4" height="2" rx="1" fill="#374151"></rect><line x1="2" y1="10" x2="4" y2="10" stroke="#374151" stroke-width="1"></line><line x1="20" y1="10" x2="22" y2="10" stroke="#374151" stroke-width="1"></line></svg> Tutor IA</div> <div id="chatbox" class="chatbody svelte-1objkjl"></div> <div class="composer svelte-1objkjl"><textarea class="textarea svelte-1objkjl" placeholder="Escribe tu mensaje‚Ä¶ (Shift+Enter para salto de l√≠nea)"></textarea> <button class="btn svelte-1objkjl"> </button></div></section> <aside class="card pad panel svelte-1objkjl"><div><div class="label svelte-1objkjl" style="margin:0 0 8px;">Estado del brief</div> <div style="display:flex; gap:8px; flex-wrap:wrap;"><span> </span> <span> </span> <span> </span></div></div> <div class="meta-block svelte-1objkjl"><h4 class="svelte-1objkjl">Descripci√≥n</h4> <!></div> <div class="meta-block svelte-1objkjl"><h4 class="svelte-1objkjl">Herramientas</h4> <!></div> <div class="meta-block svelte-1objkjl"><h4 class="svelte-1objkjl">Consejo</h4> <p class="meta-text svelte-1objkjl"><!></p></div></aside></div> <div class="footer svelte-1objkjl"><div></div> <div style="display:flex; gap:8px; align-items:center;"><!> <button class="btn primary svelte-1objkjl">Continuar con evaluaci√≥n √©tica</button></div></div></div></div>');function ta(oe,le){Se(le,!1);let k=d(null),h=d(""),$=d(""),n=d([]),_=d(!1),j=d(""),y=d(null),p=d(""),b=d(""),g=d(!1);const x=()=>!!(a(y)&&(a(p)?.trim().length??0)>=20);function ne(e,t){l(n,[...a(n),{role:e,content:t,ts:Date.now()}]),queueMicrotask(()=>{const s=document.getElementById("chatbox");s&&(s.scrollTop=s.scrollHeight)})}$e(async()=>{try{const e=localStorage.getItem("access_token")||"",t=await fetch(`${K}/intake/new_chat`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({})});if(!t.ok)throw new Error(await t.text());const s=await t.json();l(k,s.draft_id),l(h,s.default_name||`Evaluaci√≥n ${new Date().toLocaleDateString()}-${Date.now()}-${Math.floor(Math.random()*1e4)}`),ne("assistant",`üëã Hola, soy tu Tutor IA. Cu√©ntame brevemente tu objetivo y en qu√© etapa del proyecto te encuentras.

Para orientarte mejor, estas son las etapas que suelo manejar:
	 - Creaci√≥n de Contenidos 
	 - Revisi√≥n y Validaci√≥n 
	 - Publicaci√≥n y Difusi√≥n 
	 -Posproducci√≥n 
	 -MonitoreoPlanificaci√≥n.

 Te har√© algunas preguntas y cuando creas que est√° todo lo que necesitas compartir puedes hacer clic en "Continuar con evaluaci√≥n √©tica". ¬°Empecemos!`)}catch(e){l(j,e?.message||"No se pudo iniciar el chat.")}});async function ce(e,t,s=12){a(n)[t]?.role!=="assistant"&&(l(n,[...a(n),{role:"assistant",content:"",ts:Date.now()}]),t=a(n).length-1);for(let c=0;c<e.length;c++)Ae(n,a(n)[t].content+=e[c]),l(n,[...a(n)]),queueMicrotask(()=>{const v=document.getElementById("chatbox");v&&(v.scrollTop=v.scrollHeight)}),await new Promise(v=>setTimeout(v,s))}async function R(){const e=a($).trim();if(!(!e||!a(k))){l(j,""),l(n,[...a(n),{role:"user",content:e,ts:Date.now()}]),l($,""),queueMicrotask(()=>{const t=document.getElementById("chatbox");t&&(t.scrollTop=t.scrollHeight)});try{l(_,!0);const t=localStorage.getItem("access_token")||"",s=await fetch(`${K}/intake/${a(k)}/message`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({message:e,current_name:a(h)||null})});if(!s.ok)throw new Error(await s.text());const c=await s.json();await ce(c.reply,a(n).length);const v=c.extracted||{};v.etapa&&l(y,v.etapa),v.descripcion&&l(p,v.descripcion),v.herramientas&&l(b,v.herramientas),typeof c.ready=="boolean"&&l(g,c.ready)}catch(t){l(j,t?.message||"Error al enviar el mensaje.")}finally{l(_,!1)}}}async function ve(){if(!x()){l(j,"Necesito al menos la etapa y una descripci√≥n breve (‚â• 20 chars).");return}const e={etapa:a(y),descripcion:a(p).trim(),herramientas:a(b).trim(),nombre:a(h)&&a(h).trim()?a(h).trim():`Evaluaci√≥n ${new Date().toLocaleDateString()}`,draft_id:a(k)};try{const t=localStorage.getItem("access_token")||"",s=await fetch(`${K}/evaluaciones/new`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},credentials:"include",mode:"cors",body:JSON.stringify(e)});if(!s.ok)throw new Error(await s.text());const c=await s.json();window.location.href=`${Oe}/evaluaciones/${c._id}/checklist`}catch(t){l(j,t?.message||"Error al crear la evaluaci√≥n.")}}Ie();var P=Ge(),F=i(P),B=i(F),V=o(i(B),2),q=i(V),de=i(q,!0);r(q),r(V),r(B);var I=o(B,2),Q=o(i(I),2);qe(Q),Te(2),r(I);var O=o(I,2),z=i(O),H=o(i(z),2);Pe(H,5,()=>a(n),Be,(e,t)=>{var s=ze(),c=i(s,!0);r(s),w(()=>{E(s,1,`msg ${a(t).role??""}`,"svelte-1objkjl"),u(c,a(t).content)}),m(e,s)}),r(H);var U=o(H,2),S=i(U);Ce(S);var D=o(S,2),pe=i(D,!0);r(D),r(U),r(z);var W=o(z,2),M=i(W),X=o(i(M),2),T=i(X),me=i(T);r(T);var C=o(T,2),ue=i(C);r(C);var N=o(C,2),he=i(N);r(N),r(X),r(M);var J=o(M,2),je=o(i(J),2);{var fe=e=>{var t=He(),s=i(t,!0);r(t),w(()=>u(s,a(p))),m(e,t)},be=e=>{var t=Me();m(e,t)};A(je,e=>{a(p)?.trim().length?e(fe):e(be,!1)})}r(J);var L=o(J,2),ke=o(i(L),2);{var _e=e=>{var t=Ne(),s=i(t,!0);r(t),w(()=>u(s,a(b))),m(e,t)},ye=e=>{var t=Je();m(e,t)};A(ke,e=>{a(b)?.trim().length?e(_e):e(ye,!1)})}r(L);var Y=o(L,2),Z=o(i(Y),2),ge=i(Z);{var xe=e=>{var t=re("‚úÖ Parece que ya est√° listo para el an√°lisis. Cuando est√©s conforme, contin√∫a para generar la evaluaci√≥n √©tica.");m(e,t)},we=e=>{var t=re("Necesito m√°s informaci√≥n para preparar el an√°lisis √©tico. Por favor, proporciona m√°s detalles sobre tu proyecto.");m(e,t)};A(ge,e=>{a(g)||x()?e(xe):e(we,!1)})}r(Z),r(Y),r(W),r(O);var ee=o(O,2),ae=o(i(ee),2),te=i(ae);{var Ee=e=>{var t=Le(),s=i(t,!0);r(t),w(()=>u(s,a(j))),m(e,t)};A(te,e=>{a(j)&&e(Ee)})}var se=o(te,2);r(ae),r(ee),r(F),r(P),w((e,t,s,c,v)=>{E(q,1,`pill ${e??""}`,"svelte-1objkjl"),u(de,t),D.disabled=!a(k)||a(_),u(pe,a(_)?"Generando‚Ä¶":"Enviar"),E(T,1,`pill ${a(y)?"green":""}`,"svelte-1objkjl"),u(me,`Etapa: ${a(y)??"‚Äî"??""}`),E(C,1,`pill ${s??""}`,"svelte-1objkjl"),u(ue,`Descripci√≥n ${c??""}`),E(N,1,`pill ${a(b)?"green":""}`,"svelte-1objkjl"),u(he,`Herramientas: ${a(b)||"‚Äî"}`),se.disabled=v},[()=>a(g)||x()?"green":"yellow",()=>a(g)||x()?"Listo para analizar":"A√∫n faltan datos",()=>a(p)&&a(p).trim().length>=20?"green":"",()=>a(p)?.trim().length?`(${a(p).trim().length} chars)`:"(vac√≠a)",()=>a(_)||!a(g)&&!x()]),ie(Q,()=>a(h),e=>l(h,e)),ie(S,()=>a($),e=>l($,e)),G("keydown",S,e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),R())}),G("click",D,R),G("click",se,ve),m(oe,P),De()}export{ta as component};
