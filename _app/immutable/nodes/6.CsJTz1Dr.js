import"../chunks/DsnmJJEf.js";import"../chunks/D_JxtCvG.js";import{o as $e}from"../chunks/B9ntrt2Q.js";import{aE as Se,aH as f,aM as w,b as a,a as m,aI as Te,aJ as i,aK as o,O as d,s as l,aL as r,aN as De,aP as Pe,aQ as Ce,aO as re}from"../chunks/H9qgBCyD.js";import{s as u}from"../chunks/DflrDu60.js";import{i as C}from"../chunks/CoHz1Npk.js";import{e as Ae,i as Ie}from"../chunks/Cg6mc7CJ.js";import{r as qe}from"../chunks/CsChzsNn.js";import{s as E}from"../chunks/CkCo88cb.js";import{e as K}from"../chunks/CV5asq_h.js";import{b as oe}from"../chunks/DicIaQeK.js";import{i as Be}from"../chunks/CQ-KNpQv.js";import{b as Oe}from"../chunks/D73iepPs.js";import{A as R}from"../chunks/gz7YWXWY.js";var Me=f("<div> </div>"),Ne=f('<p class="meta-text svelte-1objkjl"> </p>'),He=f('<p class="meta-empty svelte-1objkjl">A√∫n no hay descripci√≥n.</p>'),ze=f('<p class="meta-text svelte-1objkjl"> </p>'),Je=f('<p class="meta-empty svelte-1objkjl">Sin herramientas indicadas.</p>'),Le=f('<span class="error svelte-1objkjl"> </span>'),Ke=f('<div class="page svelte-1objkjl"><div class="container svelte-1objkjl"><section class="hero svelte-1objkjl"><div><h1 class="svelte-1objkjl">Evaluaci√≥n √©tica inicial</h1> <p class="svelte-1objkjl">Conversemos; har√© preguntas cortas y te avisar√© cuando tengamos lo m√≠nimo para analizar.</p></div> <div style="display:flex; gap:8px; align-items:center;"><span> </span></div></section> <section class="card pad svelte-1objkjl"><div class="label svelte-1objkjl">Nombre de la evaluaci√≥n</div> <input class="input svelte-1objkjl" placeholder="Ej.: Reportaje sobre acceso a la justicia en zonas rurales"/> <div class="hint svelte-1objkjl">Se autogenera al iniciar; puedes cambiarlo en cualquier momento.</div></section> <div class="layout svelte-1objkjl"><section class="card chat svelte-1objkjl" style="overflow:hidden"><div class="chathead svelte-1objkjl"><svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true" style="vertical-align:middle; margin-right:6px;"><rect x="4" y="7" width="16" height="10" rx="4" fill="#e9bf3c" stroke="#374151" stroke-width="1.5"></rect><rect x="9" y="2" width="6" height="4" rx="2" fill="#fff" stroke="#374151" stroke-width="1"></rect><circle cx="8" cy="12" r="1.5" fill="#374151"></circle><circle cx="16" cy="12" r="1.5" fill="#374151"></circle><rect x="10" y="15" width="4" height="2" rx="1" fill="#374151"></rect><line x1="2" y1="10" x2="4" y2="10" stroke="#374151" stroke-width="1"></line><line x1="20" y1="10" x2="22" y2="10" stroke="#374151" stroke-width="1"></line></svg> Tutor IA</div> <div id="chatbox" class="chatbody svelte-1objkjl"></div> <div class="composer svelte-1objkjl"><textarea class="textarea svelte-1objkjl" placeholder="Escribe tu mensaje‚Ä¶ (Shift+Enter para salto de l√≠nea)"></textarea> <button class="btn svelte-1objkjl"> </button></div></section> <aside class="card pad panel svelte-1objkjl"><div><div class="label svelte-1objkjl" style="margin:0 0 8px;">Estado del brief</div> <div style="display:flex; gap:8px; flex-wrap:wrap;"><span> </span> <span> </span> <span> </span></div></div> <div class="meta-block svelte-1objkjl"><h4 class="svelte-1objkjl">Descripci√≥n</h4> <!></div> <div class="meta-block svelte-1objkjl"><h4 class="svelte-1objkjl">Herramientas</h4> <!></div> <div class="meta-block svelte-1objkjl"><h4 class="svelte-1objkjl">Consejo</h4> <p class="meta-text svelte-1objkjl"><!></p></div></aside></div> <div class="footer svelte-1objkjl"><div></div> <div style="display:flex; gap:8px; align-items:center;"><!> <button class="btn primary svelte-1objkjl">Continuar con evaluaci√≥n √©tica</button></div></div></div></div>');function ra(ie,le){Se(le,!1);let k=d(null),h=d(""),$=d(""),n=d([]),_=d(!1),j=d(""),y=d(null),p=d(""),b=d(""),g=d(!1);const x=()=>!!(a(y)&&(a(p)?.trim().length??0)>=20);function ne(e,t){l(n,[...a(n),{role:e,content:t,ts:Date.now()}]),queueMicrotask(()=>{const s=document.getElementById("chatbox");s&&(s.scrollTop=s.scrollHeight)})}$e(async()=>{try{const e=localStorage.getItem("access_token")||"",t=await fetch(`${R}/intake/new_chat`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({})});if(!t.ok)throw new Error(await t.text());const s=await t.json();l(k,s.draft_id),l(h,s.default_name||`Evaluaci√≥n ${new Date().toLocaleDateString()}-${Date.now()}-${Math.floor(Math.random()*1e4)}`),ne("assistant",`üëã Hola, soy tu Tutor IA. Cu√©ntame brevemente tu objetivo y en qu√© etapa del proyecto te encuentras.

Para orientarte mejor, estas son las etapas que suelo manejar:
	 - Creaci√≥n de Contenidos 
	 - Revisi√≥n y Validaci√≥n 
	 - Publicaci√≥n y Difusi√≥n 
	 -Posproducci√≥n 
	 -MonitoreoPlanificaci√≥n.

 Te har√© algunas preguntas y cuando creas que est√° todo lo que necesitas compartir puedes hacer clic en "Continuar con evaluaci√≥n √©tica". ¬°Empecemos!`)}catch(e){l(j,e?.message||"No se pudo iniciar el chat.")}});async function ce(e,t,s=12){a(n)[t]?.role!=="assistant"&&(l(n,[...a(n),{role:"assistant",content:"",ts:Date.now()}]),t=a(n).length-1);for(let c=0;c<e.length;c++)Ce(n,a(n)[t].content+=e[c]),l(n,[...a(n)]),queueMicrotask(()=>{const v=document.getElementById("chatbox");v&&(v.scrollTop=v.scrollHeight)}),await new Promise(v=>setTimeout(v,s))}async function G(){const e=a($).trim();if(!(!e||!a(k))){l(j,""),l(n,[...a(n),{role:"user",content:e,ts:Date.now()}]),l($,""),queueMicrotask(()=>{const t=document.getElementById("chatbox");t&&(t.scrollTop=t.scrollHeight)});try{l(_,!0);const t=localStorage.getItem("access_token")||"",s=await fetch(`${R}/intake/${a(k)}/message`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({message:e,current_name:a(h)||null})});if(!s.ok)throw new Error(await s.text());const c=await s.json();await ce(c.reply,a(n).length);const v=c.extracted||{};v.etapa&&l(y,v.etapa),v.descripcion&&l(p,v.descripcion),v.herramientas&&l(b,v.herramientas),typeof c.ready=="boolean"&&l(g,c.ready)}catch(t){l(j,t?.message||"Error al enviar el mensaje.")}finally{l(_,!1)}}}async function ve(){if(!x()){l(j,"Necesito al menos la etapa y una descripci√≥n breve (‚â• 20 chars).");return}const e={etapa:a(y),descripcion:a(p).trim(),herramientas:a(b).trim(),nombre:a(h)&&a(h).trim()?a(h).trim():`Evaluaci√≥n ${new Date().toLocaleDateString()}`,draft_id:a(k)};try{const t=localStorage.getItem("access_token")||"",s=await fetch(`${R}/evaluaciones/new`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},credentials:"include",mode:"cors",body:JSON.stringify(e)});if(!s.ok)throw new Error(await s.text());const c=await s.json();window.location.href=`${Oe}/evaluaciones/${c._id}/checklist`}catch(t){l(j,t?.message||"Error al crear la evaluaci√≥n.")}}Be();var A=Ke(),Q=o(A),I=o(Q),V=i(o(I),2),q=o(V),de=o(q,!0);r(q),r(V),r(I);var B=i(I,2),F=i(o(B),2);qe(F),De(2),r(B);var O=i(B,2),M=o(O),N=i(o(M),2);Ae(N,5,()=>a(n),Ie,(e,t)=>{var s=Me(),c=o(s,!0);r(s),w(()=>{E(s,1,`msg ${a(t).role??""}`,"svelte-1objkjl"),u(c,a(t).content)}),m(e,s)}),r(N);var U=i(N,2),S=o(U);Pe(S);var T=i(S,2),pe=o(T,!0);r(T),r(U),r(M);var W=i(M,2),H=o(W),X=i(o(H),2),D=o(X),me=o(D);r(D);var P=i(D,2),ue=o(P);r(P);var z=i(P,2),he=o(z);r(z),r(X),r(H);var J=i(H,2),je=i(o(J),2);{var fe=e=>{var t=Ne(),s=o(t,!0);r(t),w(()=>u(s,a(p))),m(e,t)},be=e=>{var t=He();m(e,t)};C(je,e=>{a(p)?.trim().length?e(fe):e(be,!1)})}r(J);var L=i(J,2),ke=i(o(L),2);{var _e=e=>{var t=ze(),s=o(t,!0);r(t),w(()=>u(s,a(b))),m(e,t)},ye=e=>{var t=Je();m(e,t)};C(ke,e=>{a(b)?.trim().length?e(_e):e(ye,!1)})}r(L);var Y=i(L,2),Z=i(o(Y),2),ge=o(Z);{var xe=e=>{var t=re("‚úÖ Parece que ya est√° listo para el an√°lisis. Cuando est√©s conforme, contin√∫a para generar la evaluaci√≥n √©tica.");m(e,t)},we=e=>{var t=re("Necesito m√°s informaci√≥n para preparar el an√°lisis √©tico. Por favor, proporciona m√°s detalles sobre tu proyecto.");m(e,t)};C(ge,e=>{a(g)||x()?e(xe):e(we,!1)})}r(Z),r(Y),r(W),r(O);var ee=i(O,2),ae=i(o(ee),2),te=o(ae);{var Ee=e=>{var t=Le(),s=o(t,!0);r(t),w(()=>u(s,a(j))),m(e,t)};C(te,e=>{a(j)&&e(Ee)})}var se=i(te,2);r(ae),r(ee),r(Q),r(A),w((e,t,s,c,v)=>{E(q,1,`pill ${e??""}`,"svelte-1objkjl"),u(de,t),T.disabled=!a(k)||a(_),u(pe,a(_)?"Generando‚Ä¶":"Enviar"),E(D,1,`pill ${a(y)?"green":""}`,"svelte-1objkjl"),u(me,`Etapa: ${a(y)??"‚Äî"??""}`),E(P,1,`pill ${s??""}`,"svelte-1objkjl"),u(ue,`Descripci√≥n ${c??""}`),E(z,1,`pill ${a(b)?"green":""}`,"svelte-1objkjl"),u(he,`Herramientas: ${a(b)||"‚Äî"}`),se.disabled=v},[()=>a(g)||x()?"green":"yellow",()=>a(g)||x()?"Listo para analizar":"A√∫n faltan datos",()=>a(p)&&a(p).trim().length>=20?"green":"",()=>a(p)?.trim().length?`(${a(p).trim().length} chars)`:"(vac√≠a)",()=>a(_)||!a(g)&&!x()]),oe(F,()=>a(h),e=>l(h,e)),oe(S,()=>a($),e=>l($,e)),K("keydown",S,e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),G())}),K("click",T,G),K("click",se,ve),m(ie,A),Te()}export{ra as component};
