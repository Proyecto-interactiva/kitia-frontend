import"../chunks/DsnmJJEf.js";import"../chunks/HvFHLxn-.js";import{o as ua}from"../chunks/BgOYLd6G.js";import{am as ga,aU as ma,aV as _a,an as u,a as p,aq as ba,b as a,v as k,s as w,ao as i,ar as s,as as o,c as ha,f as Q,ap as E,u as r}from"../chunks/DhylKWSF.js";import{s as f}from"../chunks/DTfuptwf.js";import{i as V}from"../chunks/CDL6dHyM.js";import{e as R,i as W}from"../chunks/BC-fFCVV.js";import{r as ja,a as xa}from"../chunks/4qz2waaI.js";import{e as X}from"../chunks/C5OcQcsF.js";import{i as $a}from"../chunks/CEzXZQFJ.js";import{s as ya,a as ka}from"../chunks/DrsZDt8v.js";import{s as wa}from"../chunks/ClSUJJyg.js";import{b as Ea}from"../chunks/BQK9fp21.js";import{A as Y}from"../chunks/gz7YWXWY.js";const Pa=()=>{const v=wa;return{page:{subscribe:v.page.subscribe},navigating:{subscribe:v.navigating.subscribe},updated:v.updated}},Aa={subscribe(v){return Pa().page.subscribe(v)}};var Ma=u("<p>Cargando checklist…</p>"),Sa=u('<p style="color:#b91c1c"> </p>'),Ta=u('<span class="critica svelte-9jfjg4">Crítica</span>'),Ca=u('<div class="pregunta svelte-9jfjg4"><label style="display:flex;align-items:center;"><input type="checkbox" class="checkbox svelte-9jfjg4"/> <span> </span> <!> <span class="badge svelte-9jfjg4"> </span></label></div>'),Ia=u('<div class="card svelte-9jfjg4"><div class="pilar-title svelte-9jfjg4"> <span class="badge svelte-9jfjg4"> </span></div> <p style="font-size:13px;color:#6b7280;margin-bottom:12px"> </p> <!></div>'),Ua=u('<div class="progreso svelte-9jfjg4"><div> </div></div> <button class="btn" style="background:#4338ca;color:#fff;border:none;cursor:pointer;">Ver resultados</button> <!>',1),Va=u('<div class="container svelte-9jfjg4"><h1>Evaluación Ética</h1> <!></div>');function Xa(v,z){ga(z,!1);const B=()=>ka(Aa,"$page",Z),[Z,q]=ya(),$=k();let g=k([]),D=k(!0),P=k("");ua(async()=>{try{const t=await fetch(`${Y}/evaluaciones/${a($)}/checklist`);if(!t.ok)throw new Error(await t.text());w(g,await t.json()),console.log(a(g)),console.log("Evaluacion ID:",t)}catch(t){w(P,t.message)}finally{w(D,!1)}});function aa(t,n){const l=a(g).find(b=>b.id===t);if(!l)return;const d=l.preguntas.find(b=>b.id===n);d&&(d.completada=!d.completada,fetch(`${Y}/evaluaciones/${a($)}/preguntas/${n}`,{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify({completada:d.completada,notas:d.notas??""})}))}function J(){const t=a(g).flatMap(l=>l.preguntas);return{comp:t.filter(l=>l.completada).length,total:t.length}}function ta(){return a(g).flatMap(t=>t.preguntas).reduce((t,n)=>t+(n.completada?n.puntos:0),0)}ma(()=>B(),()=>{w($,B().params.id)}),_a(),$a();var A=Va(),ea=i(s(A),2);{var sa=t=>{var n=Ma();p(t,n)},oa=t=>{var n=ha(),l=Q(n);{var d=m=>{var _=Sa(),h=s(_,!0);o(_),E(()=>f(h,a(P))),p(m,_)},b=m=>{var _=Ua(),h=Q(_),N=s(h),ra=s(N);o(N),o(h);var O=i(h,2),na=i(O,2);R(na,1,()=>a(g),W,(M,e)=>{var j=Ia(),S=s(j),F=s(S),G=i(F),ca=s(G);o(G),o(S);var T=i(S,2),ia=s(T,!0);o(T);var la=i(T,2);R(la,1,()=>(a(e),r(()=>a(e).preguntas)),W,(x,c)=>{var C=Ca(),H=s(C),y=s(H);ja(y);var I=i(y,2),pa=s(I,!0);o(I);var K=i(I,2);{var va=U=>{var fa=Ta();p(U,fa)};V(K,U=>{a(c),r(()=>a(c).critica)&&U(va)})}var L=i(K,2),da=s(L);o(L),o(H),o(C),E(()=>{xa(y,(a(c),r(()=>a(c).completada))),f(pa,(a(c),r(()=>a(c).texto))),f(da,`${a(c),r(()=>a(c).puntos)??""} pts`)}),X("change",y,()=>aa(a(e).id,a(c).id)),p(x,C)}),o(j),E(x=>{f(F,`${a(e),r(()=>a(e).nombre)??""} `),f(ca,`${x??""}/${a(e),r(()=>a(e).preguntas.length)??""}`),f(ia,(a(e),r(()=>a(e).descripcion)))},[()=>(a(e),r(()=>a(e).preguntas.filter(x=>x.completada).length))]),p(M,j)}),E((M,e,j)=>f(ra,`Progreso: ${M??""} de ${e??""} preguntas · Puntos: ${j??""}`),[()=>r(()=>J().comp),()=>r(()=>J().total),()=>r(ta)]),X("click",O,()=>window.location.href=`${Ea}/evaluaciones/${a($)}/resultados`),p(m,_)};V(l,m=>{a(P)?m(d):m(b,!1)},!0)}p(t,n)};V(ea,t=>{a(D)?t(sa):t(oa,!1)})}o(A),p(v,A),ba(),q()}export{Xa as component};
