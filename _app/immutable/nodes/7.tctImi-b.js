import"../chunks/DsnmJJEf.js";import"../chunks/nVMnYrZ1.js";import{o as me}from"../chunks/Cjn9CO99.js";import{O as fe,av as he,b as e,aD as R,aE as be,aw as D,ax as V,a as T,ay as ye,s as i,K as m,aA as c,az as l,u as $,aB as r,aC as ge,aW as je,aX as ke}from"../chunks/qD57vNRg.js";import{e as j,s as q}from"../chunks/DJhX7ZAe.js";import{i as oe}from"../chunks/DYzAGI7O.js";import{e as xe,i as _e}from"../chunks/DtI9RHvN.js";import{A as G,r as we}from"../chunks/BOyBn3DS.js";import{s as ie}from"../chunks/9OPRHuOI.js";import{b as se}from"../chunks/BLNXZVOq.js";import{i as Ee}from"../chunks/XiKBQBBS.js";import{b as $e}from"../chunks/WLyTCt2w.js";function Se(w){return function(...f){var s=f[0];return s.stopPropagation(),w?.apply(this,f)}}function Ce(w,f){var s=w.$$events?.[f.type],u=fe(s)?s.slice():s==null?[]:[s];for(var k of u)k.call(this,f)}var Ie=D("<div> </div>"),Ae=D('<span class="error svelte-1objkjl"> </span>'),Pe=D('<div class="modal-overlay svelte-1objkjl" role="dialog" aria-modal="true" aria-labelledby="congrats-title"><div class="modal-card svelte-1objkjl"><div class="modal-head svelte-1objkjl"><div class="modal-icon svelte-1objkjl" aria-hidden="true"><svg viewBox="0 0 24 24" width="26" height="26"><rect x="3" y="7" width="18" height="12" rx="6" fill="currentColor" opacity=".9"></rect><rect x="9" y="3" width="6" height="4" rx="2" fill="#0b1240" opacity=".08"></rect><circle cx="9" cy="13" r="1.6" fill="#0b1240"></circle><circle cx="15" cy="13" r="1.6" fill="#0b1240"></circle></svg></div> <h2 id="congrats-title" class="modal-title svelte-1objkjl">¬°100% alcanzado!</h2></div> <p class="modal-body svelte-1objkjl">¬øListo para ir a revisar el resultado de tu evaluaci√≥n?</p> <div class="modal-actions svelte-1objkjl"><button class="btn-ghost svelte-1objkjl" type="button">Volver</button> <button class="btn-primary svelte-1objkjl" type="button">S√≠</button></div></div></div>'),Te=D('<div class="page svelte-1objkjl"><div class="container svelte-1objkjl"><section class="hero svelte-1objkjl"><div><h1 class="svelte-1objkjl">Evaluaci√≥n √©tica inicial</h1> <p class="svelte-1objkjl">A trav√©s de esta conversaci√≥n, te ayudar√© a clarificar la situaci√≥n de tu proyecto y el contexto en el que est√°s usando IA. Con lo que compartas, construiremos una autoevaluaci√≥n y una gu√≠a de revisi√≥n √©tica pensadas para tu caso. Te har√© preguntas breves y te avisar√© cuando tengamos la informaci√≥n m√≠nima para reflexionar con mayor profundidad.</p> <p class="hint svelte-1objkjl" style="margin-top:8px; background: #fffbf0; padding:8px 12px; border-radius:8px; border:1px solid #f3e6bf;">Este proceso no eval√∫a tu desempe√±o acad√©mico ni reemplaza decisiones docentes. Es una herramienta que entrega un espacio de apoyo para la reflexi√≥n y autoevaluaci√≥n √©tica.</p></div> <div style="display:flex; gap:8px; align-items:center;"><span> </span></div></section> <section class="card pad svelte-1objkjl"><div class="label svelte-1objkjl">Nombre de la evaluaci√≥n</div> <input class="input svelte-1objkjl" placeholder="Ej.: Reportaje sobre acceso a la justicia en zonas rurales"/> <div class="hint svelte-1objkjl">Se autogenera al iniciar; puedes cambiarlo en cualquier momento.</div></section> <div class="layout svelte-1objkjl"><section class="card chat svelte-1objkjl" style="overflow:hidden"><div class="chathead svelte-1objkjl"><svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true" style="vertical-align:middle; margin-right:6px;"><rect x="4" y="7" width="16" height="10" rx="4" fill="#e9bf3c" stroke="#374151" stroke-width="1.5"></rect><rect x="9" y="2" width="6" height="4" rx="2" fill="#fff" stroke="#374151" stroke-width="1"></rect><circle cx="8" cy="12" r="1.5" fill="#374151"></circle><circle cx="16" cy="12" r="1.5" fill="#374151"></circle><rect x="10" y="15" width="4" height="2" rx="1" fill="#374151"></rect><line x1="2" y1="10" x2="4" y2="10" stroke="#374151" stroke-width="1"></line><line x1="20" y1="10" x2="22" y2="10" stroke="#374151" stroke-width="1"></line></svg> KitIA</div> <div id="chatbox" class="chatbody svelte-1objkjl"></div> <div class="composer svelte-1objkjl"><textarea class="textarea svelte-1objkjl" placeholder="Comenta de qu√© trata tu tarea para recibir una mejor gu√≠a‚Ä¶ (Shift+Enter para salto de l√≠nea)"></textarea> <button class="btn svelte-1objkjl"> </button></div></section></div> <div class="footer svelte-1objkjl"><div></div> <div style="display:flex; gap:8px; align-items:center;"><!> <button class="btn primary svelte-1objkjl">Continuar con evaluaci√≥n √©tica</button></div></div></div> <!></div>');function Ve(w,f){he(f,!1);let s=m(null),u=m(""),k=m(""),n=m([]),x=m(!1),y=m(""),S=null,C="",B="",p=m(!1);const E=()=>!!(S&&(C?.trim().length??0)>=20);function re(a,t){i(n,[...e(n),{role:a,content:t,ts:Date.now()}]),queueMicrotask(()=>{const o=document.getElementById("chatbox");o&&(o.scrollTop=o.scrollHeight)})}me(async()=>{try{const a=localStorage.getItem("access_token")||"",t=await fetch(`${G}/intake/new_chat`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({})});if(!t.ok)throw new Error(await t.text());const o=await t.json();i(s,o.draft_id),i(u,o.default_name||`Evaluaci√≥n ${new Date().toLocaleDateString()}-${Date.now()}-${Math.floor(Math.random()*1e4)}`),re("assistant",`üëã Hola, soy KitIA. Mi rol es ayudarte a pensar y describir con claridad la situaci√≥n de tu proyecto y c√≥mo est√°s considerando el uso de IA. A partir de lo que compartas, construiremos una autoevaluaci√≥n y una gu√≠a de revisi√≥n √©tica que te sirvan como apoyo para tomar decisiones responsables.

Cu√©ntame brevemente tu objetivo y en qu√© etapa del proyecto te encuentras. Para orientar mejor la reflexi√≥n, estas son algunas etapas del proceso creativo donde suele aparecer el uso de IA:
 - Creaci√≥n de Contenidos
 - Revisi√≥n y Validaci√≥n
 - Publicaci√≥n y Difusi√≥n
 - Posproducci√≥n
 - Monitoreo

Te har√© algunas preguntas para comprender mejor tu contexto y ayudarte a revisar tu proyecto desde una perspectiva √©tica. Cuando sientas que ya entregaste la informaci√≥n relevante, puedes hacer clic en 'Continuar con evaluaci√≥n √©tica'. ¬°Empecemos!`)}catch(a){i(y,a?.message||"No se pudo iniciar el chat.")}});async function ne(a,t,o=12){e(n)[t]?.role!=="assistant"&&(i(n,[...e(n),{role:"assistant",content:"",ts:Date.now()}]),t=e(n).length-1);for(let d=0;d<a.length;d++)ke(n,e(n)[t].content+=a[d]),i(n,[...e(n)]),queueMicrotask(()=>{const v=document.getElementById("chatbox");v&&(v.scrollTop=v.scrollHeight)}),await new Promise(v=>setTimeout(v,o))}async function U(){const a=e(k).trim();if(!(!a||!e(s))){i(y,""),i(n,[...e(n),{role:"user",content:a,ts:Date.now()}]),i(k,""),queueMicrotask(()=>{const t=document.getElementById("chatbox");t&&(t.scrollTop=t.scrollHeight)});try{const t=e(n).lenght>2?e(n).slice(-2):"",o=`${a}

Contexto actual: 
 -√öltimo mensajes: ${JSON.stringify(t)} 
- Etapa: ${S||"no especificada"}
- Descripci√≥n: ${C||"no especificada"}
- Herramientas: ${B||"no especificadas"} 
 - n√∫mero de msjs previos: ${e(n).length/2}`;i(x,!0);const d=localStorage.getItem("access_token")||"",v=await fetch(`${G}/intake/${e(s)}/message`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({message:o,current_name:e(u)||null})});if(!v.ok)throw new Error(await v.text());const _=await v.json();await ne(_.reply,e(n).length);const b=_.extracted||{};b.etapa&&(S=b.etapa),b.descripcion&&(C=b.descripcion),b.herramientas&&(B=b.herramientas),typeof _.ready=="boolean"&&i(p,_.ready)}catch(t){i(y,t?.message||"Error al enviar el mensaje.")}finally{i(x,!1)}}}async function W(){if(!E()){i(y,"Necesito al menos la etapa y una descripci√≥n breve (‚â• 20 chars).");return}const a={etapa:S,descripcion:C.trim(),herramientas:B.trim(),nombre:e(u)&&e(u).trim()?e(u).trim():`Evaluaci√≥n ${new Date().toLocaleDateString()}`,draft_id:e(s)};try{const t=localStorage.getItem("access_token")||"",o=await fetch(`${G}/evaluaciones/new`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},credentials:"include",mode:"cors",body:JSON.stringify(a)});if(!o.ok)throw new Error(await o.text());const d=await o.json();window.location.href=`${$e}/evaluaciones/${d._id}/checklist`}catch(t){i(y,t?.message||"Error al crear la evaluaci√≥n.")}}let h=m(!1),g=m(!1);const O=a=>`ethics_ready_popup_${a??"new"}`;function I(){i(h,!1),i(g,!0),e(s)&&localStorage.setItem(O(e(s)),"1")}async function le(){await W(),I()}typeof window<"u"&&window.addEventListener("keydown",a=>{a.key==="Escape"&&e(h)&&I()}),R(()=>(e(s),e(g)),()=>{e(s)&&!e(g)&&i(g,localStorage.getItem(O(e(s)))==="1")}),R(()=>(e(p),e(s),e(g),e(h)),()=>{(e(p)||E())&&e(s)&&!e(g)&&!e(h)&&(i(h,!0),i(g,!0),localStorage.setItem(O(e(s)),"1"))}),R(()=>e(h),()=>{typeof document<"u"&&(document.body.style.overflow=e(h)?"hidden":"")}),be(),Ee();var M=Te(),z=l(M),N=l(z),X=c(l(N),2),K=l(X),ce=l(K,!0);r(K),r(X),r(N);var H=c(N,2),Y=c(l(H),2);we(Y),ge(2),r(H);var L=c(H,2),F=l(L),J=c(l(F),2);xe(J,5,()=>e(n),_e,(a,t)=>{var o=Ie(),d=l(o,!0);r(o),V(()=>{ie(o,1,`msg ${e(t),$(()=>e(t).role)??""}`,"svelte-1objkjl"),q(d,(e(t),$(()=>e(t).content)))}),T(a,o)}),r(J);var Q=c(J,2),A=l(Q);je(A);var P=c(A,2),de=l(P,!0);r(P),r(Q),r(F),r(L);var Z=c(L,2),ee=c(l(Z),2),ae=l(ee);{var ve=a=>{var t=Ae(),o=l(t,!0);r(t),V(()=>q(o,e(y))),T(a,t)};oe(ae,a=>{e(y)&&a(ve)})}var te=c(ae,2);r(ee),r(Z),r(z);var ue=c(z,2);{var pe=a=>{var t=Pe(),o=l(t),d=c(l(o),4),v=l(d),_=c(v,2);r(d),r(o),r(t),j("click",v,I),j("click",_,le),j("click",o,Se(function(b){Ce.call(this,f,b)})),j("click",t,I),T(a,t)};oe(ue,a=>{e(h)&&a(pe)})}r(M),V((a,t,o)=>{ie(K,1,`pill ${a??""}`,"svelte-1objkjl"),q(ce,t),P.disabled=!e(s)||e(x),q(de,e(x)?"Generando‚Ä¶":"Enviar"),te.disabled=o},[()=>(e(p),$(()=>e(p)||E()?"green":"yellow")),()=>(e(p),$(()=>e(p)||E()?"Listo para analizar":"A√∫n faltan datos")),()=>(e(x),e(p),$(()=>e(x)||!e(p)&&!E()))]),se(Y,()=>e(u),a=>i(u,a)),se(A,()=>e(k),a=>i(k,a)),j("keydown",A,a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),U())}),j("click",P,U),j("click",te,W),T(w,M),ye()}export{Ve as component};
