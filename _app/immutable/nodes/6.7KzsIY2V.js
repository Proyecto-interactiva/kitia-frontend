import"../chunks/DsnmJJEf.js";import"../chunks/BFDTQnE2.js";import{o as ze}from"../chunks/D1BxDaDw.js";import{O as Me,av as Ne,b as e,aw as Q,ax as He,ay as _,aD as D,a as f,az as Le,s as r,K as u,aA as l,aB as i,u as h,aC as o,aE as Ke,aW as Je,aX as Re,aF as ue}from"../chunks/SI9NORCZ.js";import{e as E,s as j}from"../chunks/vrbBCUDO.js";import{i as I}from"../chunks/Bk_PEv9-.js";import{e as Ve,i as Fe}from"../chunks/ANp3hlrG.js";import{A as Z,r as Ge}from"../chunks/BWIOaSNU.js";import{s as A}from"../chunks/BPRpnUBQ.js";import{b as me}from"../chunks/DT30U8uU.js";import{i as Ue}from"../chunks/DM9A9UiJ.js";import{b as We}from"../chunks/CzCBtl6K.js";function Xe(P){return function(...y){var n=y[0];return n.stopPropagation(),P?.apply(this,y)}}function Ye(P,y){var n=P.$$events?.[y.type],b=Me(n)?n.slice():n==null?[]:[n];for(var S of b)S.call(this,y)}var Qe=_("<div> </div>"),Ze=_('<p class="meta-text svelte-1objkjl"> </p>'),ea=_('<p class="meta-empty svelte-1objkjl">A√∫n no hay descripci√≥n.</p>'),aa=_('<p class="meta-text svelte-1objkjl"> </p>'),ta=_('<p class="meta-empty svelte-1objkjl">Sin herramientas indicadas.</p>'),sa=_('<span class="error svelte-1objkjl"> </span>'),oa=_('<div class="modal-overlay svelte-1objkjl" role="dialog" aria-modal="true" aria-labelledby="congrats-title"><div class="modal-card svelte-1objkjl"><div class="modal-head svelte-1objkjl"><div class="modal-icon svelte-1objkjl" aria-hidden="true"><svg viewBox="0 0 24 24" width="26" height="26"><rect x="3" y="7" width="18" height="12" rx="6" fill="currentColor" opacity=".9"></rect><rect x="9" y="3" width="6" height="4" rx="2" fill="#0b1240" opacity=".08"></rect><circle cx="9" cy="13" r="1.6" fill="#0b1240"></circle><circle cx="15" cy="13" r="1.6" fill="#0b1240"></circle></svg></div> <h2 id="congrats-title" class="modal-title svelte-1objkjl">¬°100% alcanzado!</h2></div> <p class="modal-body svelte-1objkjl">¬øListo para ir a revisar el resultado de tu evaluaci√≥n?</p> <div class="modal-actions svelte-1objkjl"><button class="btn-ghost svelte-1objkjl" type="button">Volver</button> <button class="btn-primary svelte-1objkjl" type="button">S√≠</button></div></div></div>'),ia=_('<div class="page svelte-1objkjl"><div class="container svelte-1objkjl"><section class="hero svelte-1objkjl"><div><h1 class="svelte-1objkjl">Evaluaci√≥n √©tica inicial</h1> <p class="svelte-1objkjl">Conversemos; har√© preguntas cortas y te avisar√© cuando tengamos lo m√≠nimo para analizar.</p></div> <div style="display:flex; gap:8px; align-items:center;"><span> </span></div></section> <section class="card pad svelte-1objkjl"><div class="label svelte-1objkjl">Nombre de la evaluaci√≥n</div> <input class="input svelte-1objkjl" placeholder="Ej.: Reportaje sobre acceso a la justicia en zonas rurales"/> <div class="hint svelte-1objkjl">Se autogenera al iniciar; puedes cambiarlo en cualquier momento.</div></section> <div class="layout svelte-1objkjl"><section class="card chat svelte-1objkjl" style="overflow:hidden"><div class="chathead svelte-1objkjl"><svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true" style="vertical-align:middle; margin-right:6px;"><rect x="4" y="7" width="16" height="10" rx="4" fill="#e9bf3c" stroke="#374151" stroke-width="1.5"></rect><rect x="9" y="2" width="6" height="4" rx="2" fill="#fff" stroke="#374151" stroke-width="1"></rect><circle cx="8" cy="12" r="1.5" fill="#374151"></circle><circle cx="16" cy="12" r="1.5" fill="#374151"></circle><rect x="10" y="15" width="4" height="2" rx="1" fill="#374151"></rect><line x1="2" y1="10" x2="4" y2="10" stroke="#374151" stroke-width="1"></line><line x1="20" y1="10" x2="22" y2="10" stroke="#374151" stroke-width="1"></line></svg> Tutor IA</div> <div id="chatbox" class="chatbody svelte-1objkjl"></div> <div class="composer svelte-1objkjl"><textarea class="textarea svelte-1objkjl" placeholder="Escribe tu mensaje‚Ä¶ (Shift+Enter para salto de l√≠nea)"></textarea> <button class="btn svelte-1objkjl"> </button></div></section> <aside class="card pad panel svelte-1objkjl"><div><div class="label svelte-1objkjl" style="margin:0 0 8px;">Estado del brief</div> <div style="display:flex; gap:8px; flex-wrap:wrap;"><span> </span> <span> </span> <span> </span></div></div> <div class="meta-block svelte-1objkjl"><h4 class="svelte-1objkjl">Descripci√≥n</h4> <!></div> <div class="meta-block svelte-1objkjl"><h4 class="svelte-1objkjl">Herramientas</h4> <!></div> <div class="meta-block svelte-1objkjl"><h4 class="svelte-1objkjl">Consejo</h4> <p class="meta-text svelte-1objkjl"><!></p></div></aside></div> <div class="footer svelte-1objkjl"><div></div> <div style="display:flex; gap:8px; align-items:center;"><!> <button class="btn primary svelte-1objkjl">Continuar con evaluaci√≥n √©tica</button></div></div></div> <!></div>');function ja(P,y){Ne(y,!1);let n=u(null),b=u(""),S=u(""),d=u([]),$=u(!1),g=u(""),T=u(null),p=u(""),x=u(""),m=u(!1);const C=()=>!!(e(T)&&(e(p)?.trim().length??0)>=20);function fe(a,t){r(d,[...e(d),{role:a,content:t,ts:Date.now()}]),queueMicrotask(()=>{const s=document.getElementById("chatbox");s&&(s.scrollTop=s.scrollHeight)})}ze(async()=>{try{const a=localStorage.getItem("access_token")||"",t=await fetch(`${Z}/intake/new_chat`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({})});if(!t.ok)throw new Error(await t.text());const s=await t.json();r(n,s.draft_id),r(b,s.default_name||`Evaluaci√≥n ${new Date().toLocaleDateString()}-${Date.now()}-${Math.floor(Math.random()*1e4)}`),fe("assistant",`üëã Hola, soy tu Tutor IA. Cu√©ntame brevemente tu objetivo y en qu√© etapa del proyecto te encuentras.

Para orientarte mejor, estas son las etapas que suelo manejar:
	 - Creaci√≥n de Contenidos 
	 - Revisi√≥n y Validaci√≥n 
	 - Publicaci√≥n y Difusi√≥n 
	 -Posproducci√≥n 
	 -Monitoreo.

 Te har√© algunas preguntas y cuando creas que est√° todo lo que necesitas compartir puedes hacer clic en "Continuar con evaluaci√≥n √©tica". ¬°Empecemos!`)}catch(a){r(g,a?.message||"No se pudo iniciar el chat.")}});async function he(a,t,s=12){e(d)[t]?.role!=="assistant"&&(r(d,[...e(d),{role:"assistant",content:"",ts:Date.now()}]),t=e(d).length-1);for(let c=0;c<a.length;c++)Re(d,e(d)[t].content+=a[c]),r(d,[...e(d)]),queueMicrotask(()=>{const v=document.getElementById("chatbox");v&&(v.scrollTop=v.scrollHeight)}),await new Promise(v=>setTimeout(v,s))}async function ee(){const a=e(S).trim();if(!(!a||!e(n))){r(g,""),r(d,[...e(d),{role:"user",content:a,ts:Date.now()}]),r(S,""),queueMicrotask(()=>{const t=document.getElementById("chatbox");t&&(t.scrollTop=t.scrollHeight)});try{r($,!0);const t=localStorage.getItem("access_token")||"",s=await fetch(`${Z}/intake/${e(n)}/message`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({message:a,current_name:e(b)||null})});if(!s.ok)throw new Error(await s.text());const c=await s.json();await he(c.reply,e(d).length);const v=c.extracted||{};v.etapa&&r(T,v.etapa),v.descripcion&&r(p,v.descripcion),v.herramientas&&r(x,v.herramientas),typeof c.ready=="boolean"&&r(m,c.ready)}catch(t){r(g,t?.message||"Error al enviar el mensaje.")}finally{r($,!1)}}}async function ae(){if(!C()){r(g,"Necesito al menos la etapa y una descripci√≥n breve (‚â• 20 chars).");return}const a={etapa:e(T),descripcion:e(p).trim(),herramientas:e(x).trim(),nombre:e(b)&&e(b).trim()?e(b).trim():`Evaluaci√≥n ${new Date().toLocaleDateString()}`,draft_id:e(n)};try{const t=localStorage.getItem("access_token")||"",s=await fetch(`${Z}/evaluaciones/new`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},credentials:"include",mode:"cors",body:JSON.stringify(a)});if(!s.ok)throw new Error(await s.text());const c=await s.json();window.location.href=`${We}/evaluaciones/${c._id}/checklist`}catch(t){r(g,t?.message||"Error al crear la evaluaci√≥n.")}}let k=u(!1),w=u(!1);const N=a=>`ethics_ready_popup_${a??"new"}`;function B(){r(k,!1),r(w,!0),e(n)&&localStorage.setItem(N(e(n)),"1")}async function be(){await ae(),B()}typeof window<"u"&&window.addEventListener("keydown",a=>{a.key==="Escape"&&e(k)&&B()}),Q(()=>(e(n),e(w)),()=>{e(n)&&!e(w)&&r(w,localStorage.getItem(N(e(n)))==="1")}),Q(()=>(e(m),e(n),e(w),e(k)),()=>{(e(m)||C())&&e(n)&&!e(w)&&!e(k)&&(r(k,!0),r(w,!0),localStorage.setItem(N(e(n)),"1"))}),Q(()=>e(k),()=>{typeof document<"u"&&(document.body.style.overflow=e(k)?"hidden":"")}),He(),Ue();var H=ia(),L=i(H),K=i(L),te=l(i(K),2),J=i(te),je=i(J,!0);o(J),o(te),o(K);var R=l(K,2),se=l(i(R),2);Ge(se),Ke(2),o(R);var V=l(R,2),F=i(V),G=l(i(F),2);Ve(G,5,()=>e(d),Fe,(a,t)=>{var s=Qe(),c=i(s,!0);o(s),D(()=>{A(s,1,`msg ${e(t),h(()=>e(t).role)??""}`,"svelte-1objkjl"),j(c,(e(t),h(()=>e(t).content)))}),f(a,s)}),o(G);var oe=l(G,2),O=i(oe);Je(O);var q=l(O,2),ye=i(q,!0);o(q),o(oe),o(F);var ie=l(F,2),U=i(ie),re=l(i(U),2),z=i(re),ke=i(z);o(z);var M=l(z,2),_e=i(M);o(M);var W=l(M,2),ge=i(W);o(W),o(re),o(U);var X=l(U,2),xe=l(i(X),2);{var we=a=>{var t=Ze(),s=i(t,!0);o(t),D(()=>j(s,e(p))),f(a,t)},Ee=a=>{var t=ea();f(a,t)};I(xe,a=>{e(p),h(()=>e(p)?.trim().length)?a(we):a(Ee,!1)})}o(X);var Y=l(X,2),Se=l(i(Y),2);{var $e=a=>{var t=aa(),s=i(t,!0);o(t),D(()=>j(s,e(x))),f(a,t)},Ce=a=>{var t=ta();f(a,t)};I(Se,a=>{e(x),h(()=>e(x)?.trim().length)?a($e):a(Ce,!1)})}o(Y);var le=l(Y,2),ne=l(i(le),2),Pe=i(ne);{var Te=a=>{var t=ue("‚úÖ Parece que ya est√° listo para el an√°lisis. Cuando est√©s conforme, contin√∫a para generar la evaluaci√≥n √©tica.");f(a,t)},De=a=>{var t=ue("Necesito m√°s informaci√≥n para preparar el an√°lisis √©tico. Por favor, proporciona m√°s detalles sobre tu proyecto.");f(a,t)};I(Pe,a=>{e(m),h(()=>e(m)||C())?a(Te):a(De,!1)})}o(ne),o(le),o(ie),o(V);var ce=l(V,2),ve=l(i(ce),2),de=i(ve);{var Ie=a=>{var t=sa(),s=i(t,!0);o(t),D(()=>j(s,e(g))),f(a,t)};I(de,a=>{e(g)&&a(Ie)})}var pe=l(de,2);o(ve),o(ce),o(L);var Ae=l(L,2);{var Be=a=>{var t=oa(),s=i(t),c=l(i(s),4),v=i(c),Oe=l(v,2);o(c),o(s),o(t),E("click",v,B),E("click",Oe,be),E("click",s,Xe(function(qe){Ye.call(this,y,qe)})),E("click",t,B),f(a,t)};I(Ae,a=>{e(k)&&a(Be)})}o(H),D((a,t,s,c,v)=>{A(J,1,`pill ${a??""}`,"svelte-1objkjl"),j(je,t),q.disabled=!e(n)||e($),j(ye,e($)?"Generando‚Ä¶":"Enviar"),A(z,1,`pill ${e(T)?"green":""}`,"svelte-1objkjl"),j(ke,`Etapa: ${e(T)??"‚Äî"??""}`),A(M,1,`pill ${s??""}`,"svelte-1objkjl"),j(_e,`Descripci√≥n ${c??""}`),A(W,1,`pill ${e(x)?"green":""}`,"svelte-1objkjl"),j(ge,`Herramientas: ${e(x)||"‚Äî"}`),pe.disabled=v},[()=>(e(m),h(()=>e(m)||C()?"green":"yellow")),()=>(e(m),h(()=>e(m)||C()?"Listo para analizar":"A√∫n faltan datos")),()=>(e(p),h(()=>e(p)&&e(p).trim().length>=20?"green":"")),()=>(e(p),h(()=>e(p)?.trim().length?`(${e(p).trim().length} chars)`:"(vac√≠a)")),()=>(e($),e(m),h(()=>e($)||!e(m)&&!C()))]),me(se,()=>e(b),a=>r(b,a)),me(O,()=>e(S),a=>r(S,a)),E("keydown",O,a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),ee())}),E("click",q,ee),E("click",pe,ae),f(P,H),Le()}export{ja as component};
