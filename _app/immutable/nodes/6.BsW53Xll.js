import"../chunks/DsnmJJEf.js";import"../chunks/BArfBHBa.js";import{o as me}from"../chunks/D6F5klbK.js";import{O as fe,av as he,b as e,aw as H,ax as be,ay as P,aD as K,a as C,az as ye,s as i,K as m,aA as v,aB as l,u as x,aC as s,aE as je,aW as ge,aX as ke}from"../chunks/JwfWP7l2.js";import{e as j,s as T}from"../chunks/D73Aelo1.js";import{i as te}from"../chunks/VnCXLVbX.js";import{e as _e,i as we}from"../chunks/CDfcZW8-.js";import{A as J,r as xe}from"../chunks/Ce2Y3TL0.js";import{s as ae}from"../chunks/DpzZfCb8.js";import{b as oe}from"../chunks/BswAZx1J.js";import{i as Ee}from"../chunks/V6Rb_VSp.js";import{b as Se}from"../chunks/CbXKVzVo.js";function $e(_){return function(...f){var r=f[0];return r.stopPropagation(),_?.apply(this,f)}}function Ce(_,f){var r=_.$$events?.[f.type],u=fe(r)?r.slice():r==null?[]:[r];for(var g of u)g.call(this,f)}var Te=P("<div> </div>"),Pe=P('<span class="error svelte-1objkjl"> </span>'),Ie=P('<div class="modal-overlay svelte-1objkjl" role="dialog" aria-modal="true" aria-labelledby="congrats-title"><div class="modal-card svelte-1objkjl"><div class="modal-head svelte-1objkjl"><div class="modal-icon svelte-1objkjl" aria-hidden="true"><svg viewBox="0 0 24 24" width="26" height="26"><rect x="3" y="7" width="18" height="12" rx="6" fill="currentColor" opacity=".9"></rect><rect x="9" y="3" width="6" height="4" rx="2" fill="#0b1240" opacity=".08"></rect><circle cx="9" cy="13" r="1.6" fill="#0b1240"></circle><circle cx="15" cy="13" r="1.6" fill="#0b1240"></circle></svg></div> <h2 id="congrats-title" class="modal-title svelte-1objkjl">¬°100% alcanzado!</h2></div> <p class="modal-body svelte-1objkjl">¬øListo para ir a revisar el resultado de tu evaluaci√≥n?</p> <div class="modal-actions svelte-1objkjl"><button class="btn-ghost svelte-1objkjl" type="button">Volver</button> <button class="btn-primary svelte-1objkjl" type="button">S√≠</button></div></div></div>'),Be=P('<div class="page svelte-1objkjl"><div class="container svelte-1objkjl"><section class="hero svelte-1objkjl"><div><h1 class="svelte-1objkjl">Evaluaci√≥n √©tica inicial</h1> <p class="svelte-1objkjl">Conversemos; har√© preguntas cortas y te avisar√© cuando tengamos lo m√≠nimo para analizar.</p></div> <div style="display:flex; gap:8px; align-items:center;"><span> </span></div></section> <section class="card pad svelte-1objkjl"><div class="label svelte-1objkjl">Nombre de la evaluaci√≥n</div> <input class="input svelte-1objkjl" placeholder="Ej.: Reportaje sobre acceso a la justicia en zonas rurales"/> <div class="hint svelte-1objkjl">Se autogenera al iniciar; puedes cambiarlo en cualquier momento.</div></section> <div class="layout svelte-1objkjl"><section class="card chat svelte-1objkjl" style="overflow:hidden"><div class="chathead svelte-1objkjl"><svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true" style="vertical-align:middle; margin-right:6px;"><rect x="4" y="7" width="16" height="10" rx="4" fill="#e9bf3c" stroke="#374151" stroke-width="1.5"></rect><rect x="9" y="2" width="6" height="4" rx="2" fill="#fff" stroke="#374151" stroke-width="1"></rect><circle cx="8" cy="12" r="1.5" fill="#374151"></circle><circle cx="16" cy="12" r="1.5" fill="#374151"></circle><rect x="10" y="15" width="4" height="2" rx="1" fill="#374151"></rect><line x1="2" y1="10" x2="4" y2="10" stroke="#374151" stroke-width="1"></line><line x1="20" y1="10" x2="22" y2="10" stroke="#374151" stroke-width="1"></line></svg> Tutor IA</div> <div id="chatbox" class="chatbody svelte-1objkjl"></div> <div class="composer svelte-1objkjl"><textarea class="textarea svelte-1objkjl" placeholder="Comenta de qu√© trata tu tarea para recibir una mejor gu√≠a‚Ä¶ (Shift+Enter para salto de l√≠nea)"></textarea> <button class="btn svelte-1objkjl"> </button></div></section></div> <div class="footer svelte-1objkjl"><div></div> <div style="display:flex; gap:8px; align-items:center;"><!> <button class="btn primary svelte-1objkjl">Continuar con evaluaci√≥n √©tica</button></div></div></div> <!></div>');function Ve(_,f){he(f,!1);let r=m(null),u=m(""),g=m(""),d=m([]),k=m(!1),b=m(""),I=null,B="",R="",p=m(!1);const w=()=>!!(I&&(B?.trim().length??0)>=20);function ie(t,a){i(d,[...e(d),{role:t,content:a,ts:Date.now()}]),queueMicrotask(()=>{const o=document.getElementById("chatbox");o&&(o.scrollTop=o.scrollHeight)})}me(async()=>{try{const t=localStorage.getItem("access_token")||"",a=await fetch(`${J}/intake/new_chat`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({})});if(!a.ok)throw new Error(await a.text());const o=await a.json();i(r,o.draft_id),i(u,o.default_name||`Evaluaci√≥n ${new Date().toLocaleDateString()}-${Date.now()}-${Math.floor(Math.random()*1e4)}`),ie("assistant",`üëã Hola, soy tu Tutor IA. Cu√©ntame brevemente tu objetivo y en qu√© etapa del proyecto te encuentras.

Para orientarte mejor, estas son las etapas que suelo manejar:
	 - Creaci√≥n de Contenidos 
	 - Revisi√≥n y Validaci√≥n 
	 - Publicaci√≥n y Difusi√≥n 
	 -Posproducci√≥n 
	 -Monitoreo.

 Te har√© algunas preguntas y cuando creas que est√° todo lo que necesitas compartir puedes hacer clic en "Continuar con evaluaci√≥n √©tica". ¬°Empecemos!`)}catch(t){i(b,t?.message||"No se pudo iniciar el chat.")}});async function re(t,a,o=12){e(d)[a]?.role!=="assistant"&&(i(d,[...e(d),{role:"assistant",content:"",ts:Date.now()}]),a=e(d).length-1);for(let n=0;n<t.length;n++)ke(d,e(d)[a].content+=t[n]),i(d,[...e(d)]),queueMicrotask(()=>{const c=document.getElementById("chatbox");c&&(c.scrollTop=c.scrollHeight)}),await new Promise(c=>setTimeout(c,o))}async function V(){const t=e(g).trim();if(!(!t||!e(r))){i(b,""),i(d,[...e(d),{role:"user",content:t,ts:Date.now()}]),i(g,""),queueMicrotask(()=>{const a=document.getElementById("chatbox");a&&(a.scrollTop=a.scrollHeight)});try{i(k,!0);const a=localStorage.getItem("access_token")||"",o=await fetch(`${J}/intake/${e(r)}/message`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({message:t,current_name:e(u)||null})});if(!o.ok)throw new Error(await o.text());const n=await o.json();await re(n.reply,e(d).length);const c=n.extracted||{};c.etapa&&(I=c.etapa),c.descripcion&&(B=c.descripcion),c.herramientas&&(R=c.herramientas),typeof n.ready=="boolean"&&i(p,n.ready)}catch(a){i(b,a?.message||"Error al enviar el mensaje.")}finally{i(k,!1)}}}async function G(){if(!w()){i(b,"Necesito al menos la etapa y una descripci√≥n breve (‚â• 20 chars).");return}const t={etapa:I,descripcion:B.trim(),herramientas:R.trim(),nombre:e(u)&&e(u).trim()?e(u).trim():`Evaluaci√≥n ${new Date().toLocaleDateString()}`,draft_id:e(r)};try{const a=localStorage.getItem("access_token")||"",o=await fetch(`${J}/evaluaciones/new`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},credentials:"include",mode:"cors",body:JSON.stringify(t)});if(!o.ok)throw new Error(await o.text());const n=await o.json();window.location.href=`${Se}/evaluaciones/${n._id}/checklist`}catch(a){i(b,a?.message||"Error al crear la evaluaci√≥n.")}}let h=m(!1),y=m(!1);const D=t=>`ethics_ready_popup_${t??"new"}`;function E(){i(h,!1),i(y,!0),e(r)&&localStorage.setItem(D(e(r)),"1")}async function se(){await G(),E()}typeof window<"u"&&window.addEventListener("keydown",t=>{t.key==="Escape"&&e(h)&&E()}),H(()=>(e(r),e(y)),()=>{e(r)&&!e(y)&&i(y,localStorage.getItem(D(e(r)))==="1")}),H(()=>(e(p),e(r),e(y),e(h)),()=>{(e(p)||w())&&e(r)&&!e(y)&&!e(h)&&(i(h,!0),i(y,!0),localStorage.setItem(D(e(r)),"1"))}),H(()=>e(h),()=>{typeof document<"u"&&(document.body.style.overflow=e(h)?"hidden":"")}),be(),Ee();var A=Be(),O=l(A),q=l(O),U=v(l(q),2),z=l(U),le=l(z,!0);s(z),s(U),s(q);var M=v(q,2),W=v(l(M),2);xe(W),je(2),s(M);var N=v(M,2),X=l(N),L=v(l(X),2);_e(L,5,()=>e(d),we,(t,a)=>{var o=Te(),n=l(o,!0);s(o),K(()=>{ae(o,1,`msg ${e(a),x(()=>e(a).role)??""}`,"svelte-1objkjl"),T(n,(e(a),x(()=>e(a).content)))}),C(t,o)}),s(L);var Y=v(L,2),S=l(Y);ge(S);var $=v(S,2),ne=l($,!0);s($),s(Y),s(X),s(N);var F=v(N,2),Q=v(l(F),2),Z=l(Q);{var ce=t=>{var a=Pe(),o=l(a,!0);s(a),K(()=>T(o,e(b))),C(t,a)};te(Z,t=>{e(b)&&t(ce)})}var ee=v(Z,2);s(Q),s(F),s(O);var de=v(O,2);{var ve=t=>{var a=Ie(),o=l(a),n=v(l(o),4),c=l(n),ue=v(c,2);s(n),s(o),s(a),j("click",c,E),j("click",ue,se),j("click",o,$e(function(pe){Ce.call(this,f,pe)})),j("click",a,E),C(t,a)};te(de,t=>{e(h)&&t(ve)})}s(A),K((t,a,o)=>{ae(z,1,`pill ${t??""}`,"svelte-1objkjl"),T(le,a),$.disabled=!e(r)||e(k),T(ne,e(k)?"Generando‚Ä¶":"Enviar"),ee.disabled=o},[()=>(e(p),x(()=>e(p)||w()?"green":"yellow")),()=>(e(p),x(()=>e(p)||w()?"Listo para analizar":"A√∫n faltan datos")),()=>(e(k),e(p),x(()=>e(k)||!e(p)&&!w()))]),oe(W,()=>e(u),t=>i(u,t)),oe(S,()=>e(g),t=>i(g,t)),j("keydown",S,t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),V())}),j("click",$,V),j("click",ee,G),C(_,A),ye()}export{Ve as component};
