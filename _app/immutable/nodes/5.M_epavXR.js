import"../chunks/DsnmJJEf.js";import"../chunks/Co3yc64f.js";import{o as ua}from"../chunks/DxZOmja6.js";import{am as ga,aT as ma,aU as _a,an as u,a as p,aq as ba,G as a,X as k,I as w,ao as i,ar as s,as as o,c as ha,f as L,ap as E,j as r}from"../chunks/tjmoeONZ.js";import{s as f}from"../chunks/r1iMuBZ-.js";import{i as z}from"../chunks/9jrT_3zx.js";import{e as Q,i as R}from"../chunks/DRDXhByV.js";import{r as ja,a as xa}from"../chunks/VJiT-DM5.js";import{e as W}from"../chunks/C-MdJe_B.js";import{i as $a}from"../chunks/8ghubDwy.js";import{s as ya,a as ka}from"../chunks/BySM2QB6.js";import{s as wa}from"../chunks/sEd1OfBy.js";import{b as Ea}from"../chunks/B9-9SU0V.js";import{A as Y}from"../chunks/gz7YWXWY.js";const Pa=()=>{const v=wa;return{page:{subscribe:v.page.subscribe},navigating:{subscribe:v.navigating.subscribe},updated:v.updated}},Ta={subscribe(v){return Pa().page.subscribe(v)}};var Aa=u("<p>Cargando checklist…</p>"),Ia=u('<p style="color:#b91c1c"> </p>'),Ma=u('<span class="critica svelte-9jfjg4">Crítica</span>'),Sa=u('<div class="pregunta svelte-9jfjg4"><label style="display:flex;align-items:center;"><input type="checkbox" class="checkbox svelte-9jfjg4"/> <span> </span> <!> <span class="badge svelte-9jfjg4"> </span></label></div>'),Ca=u('<div class="card svelte-9jfjg4"><div class="pilar-title svelte-9jfjg4"> <span class="badge svelte-9jfjg4"> </span></div> <p style="font-size:13px;color:#6b7280;margin-bottom:12px"> </p> <!></div>'),Ua=u('<div class="progreso svelte-9jfjg4"><div> </div></div> <button class="btn" style="background:#4338ca;color:#fff;border:none;cursor:pointer;">Ver resultados</button> <!>',1),za=u('<div class="container svelte-9jfjg4"><h1>Evaluación Ética</h1> <!></div>');function Wa(v,B){ga(B,!1);const D=()=>ka(Ta,"$page",Z),[Z,q]=ya(),$=k();let g=k([]),G=k(!0),P=k("");ua(async()=>{try{const t=await fetch(`${Y}/evaluaciones/${a($)}/checklist`);if(!t.ok)throw new Error(await t.text());w(g,await t.json()),console.log(a(g)),console.log("Evaluacion ID:",t)}catch(t){w(P,t.message)}finally{w(G,!1)}});function aa(t,n){const l=a(g).find(b=>b.id===t);if(!l)return;const d=l.preguntas.find(b=>b.id===n);d&&(d.completada=!d.completada,fetch(`${Y}/evaluaciones/${a($)}/preguntas/${n}`,{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify({completada:d.completada,notas:d.notas??""})}))}function J(){const t=a(g).flatMap(l=>l.preguntas);return{comp:t.filter(l=>l.completada).length,total:t.length}}function ta(){return a(g).flatMap(t=>t.preguntas).reduce((t,n)=>t+(n.completada?n.puntos:0),0)}ma(()=>D(),()=>{w($,D().params.id)}),_a(),$a();var T=za(),ea=i(s(T),2);{var sa=t=>{var n=Aa();p(t,n)},oa=t=>{var n=ha(),l=L(n);{var d=m=>{var _=Ia(),h=s(_,!0);o(_),E(()=>f(h,a(P))),p(m,_)},b=m=>{var _=Ua(),h=L(_),N=s(h),ra=s(N);o(N),o(h);var O=i(h,2),na=i(O,2);Q(na,1,()=>a(g),R,(A,e)=>{var j=Ca(),I=s(j),V=s(I),X=i(V),ca=s(X);o(X),o(I);var M=i(I,2),ia=s(M,!0);o(M);var la=i(M,2);Q(la,1,()=>(a(e),r(()=>a(e).preguntas)),R,(x,c)=>{var S=Sa(),F=s(S),y=s(F);ja(y);var C=i(y,2),pa=s(C,!0);o(C);var H=i(C,2);{var va=U=>{var fa=Ma();p(U,fa)};z(H,U=>{a(c),r(()=>a(c).critica)&&U(va)})}var K=i(H,2),da=s(K);o(K),o(F),o(S),E(()=>{xa(y,(a(c),r(()=>a(c).completada))),f(pa,(a(c),r(()=>a(c).texto))),f(da,`${a(c),r(()=>a(c).puntos)??""} pts`)}),W("change",y,()=>aa(a(e).id,a(c).id)),p(x,S)}),o(j),E(x=>{f(V,`${a(e),r(()=>a(e).nombre)??""} `),f(ca,`${x??""}/${a(e),r(()=>a(e).preguntas.length)??""}`),f(ia,(a(e),r(()=>a(e).descripcion)))},[()=>(a(e),r(()=>a(e).preguntas.filter(x=>x.completada).length))]),p(A,j)}),E((A,e,j)=>f(ra,`Progreso: ${A??""} de ${e??""} preguntas · Puntos: ${j??""}`),[()=>r(()=>J().comp),()=>r(()=>J().total),()=>r(ta)]),W("click",O,()=>window.location.href=`${Ea}/evaluaciones/${a($)}/resultados`),p(m,_)};z(l,m=>{a(P)?m(d):m(b,!1)},!0)}p(t,n)};z(ea,t=>{a(G)?t(sa):t(oa,!1)})}o(T),p(v,T),ba(),q()}export{Wa as component};
