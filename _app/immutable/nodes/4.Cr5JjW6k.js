import"../chunks/DsnmJJEf.js";import"../chunks/uehYZzkF.js";import{o as ze,a as Ee}from"../chunks/CFuMONhm.js";import{av as Le,aw as T,ax as Ae,ay as h,a as d,az as Ie,b as e,O as u,s as c,aB as t,aC as a,aA as r,aD as b,u as i,c as Pe,f as ie,aF as De}from"../chunks/oOC6CyD3.js";import{s as g,e as G}from"../chunks/Bj18uxIO.js";import{i as L}from"../chunks/C2ciDzbX.js";import{e as H,i as K}from"../chunks/lE9yVeNz.js";import{A as le,s as Oe,r as Re,a as Se}from"../chunks/CdqO7dcH.js";import{s as Te}from"../chunks/DbCbTNl9.js";import{s as Ve}from"../chunks/BdQBcVY9.js";import{i as Fe}from"../chunks/BBFBmJEc.js";import{s as Je,a as Ne}from"../chunks/B43ZDVyP.js";import{p as Ue}from"../chunks/1SYCn9IG.js";import{b as We}from"../chunks/DeN2zgxv.js";var Ge=h('<div class="skeletonCard svelte-9jfjg4"><span class="skDot svelte-9jfjg4"></span> <div class="skLines svelte-9jfjg4"><span class="skLine svelte-9jfjg4"></span> <span class="skLine short svelte-9jfjg4"></span></div> <span class="skBadge svelte-9jfjg4"></span></div>'),He=h('<section class="loadingWrap svelte-9jfjg4" aria-busy="true" aria-live="polite"><div class="loader svelte-9jfjg4"><div class="pill svelte-9jfjg4"><svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true" class="svelte-9jfjg4"><path d="M20 6L9 17l-5-5" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svelte-9jfjg4"></path></svg> <span class="orbit svelte-9jfjg4"></span></div> <div class="progress svelte-9jfjg4" role="progressbar" aria-valuemin="0" aria-valuemax="100"><div class="bar svelte-9jfjg4"></div></div> <div class="tip svelte-9jfjg4"><strong class="svelte-9jfjg4"> </strong> </div></div> <div class="skeletonList svelte-9jfjg4"></div></section>'),Ke=h('<p class="error svelte-9jfjg4"> </p>'),Qe=h('<p style="margin:0; color:var(--muted); font-size:14px" class="svelte-9jfjg4"><strong class="svelte-9jfjg4">Etapa:</strong> </p>'),Xe=h('<p style="margin:0 0 6px; color:var(--muted)" class="svelte-9jfjg4"><strong class="svelte-9jfjg4">Descripción:</strong> </p>'),Ye=h('<p class="pilar-desc svelte-9jfjg4"> </p>'),Ze=h('<label><input class="check svelte-9jfjg4" type="checkbox"/> <span class="tick svelte-9jfjg4" aria-hidden="true"><svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" class="svelte-9jfjg4"><path d="M20 6L9 17l-5-5" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svelte-9jfjg4"></path></svg></span> <span class="qtext svelte-9jfjg4"> </span> <span class="meta svelte-9jfjg4"><!> </span></label>'),qe=h('<section class="pilar svelte-9jfjg4"><h2 class="pilar-title svelte-9jfjg4"> </h2> <!> <div class="list svelte-9jfjg4"></div></section>'),ea=h(`<header class="heading svelte-9jfjg4"><h1 class="svelte-9jfjg4"></h1></header> <div class="card svelte-9jfjg4" style="max-width:980px; margin:0 auto 20px; padding:16px;"><h2 style="margin:0 0 6px" class="svelte-9jfjg4"> </h2> <!> <!></div> <hr class="svelte-9jfjg4"/> <h1 style="text-align:center; margin: 20px auto 10px; font-size: clamp(20px,4vw,32px); max-width:980px;" class="svelte-9jfjg4">Checklist de Principios</h1> <p style="text-align:center; margin:0 auto 24px; color:
            var(--muted); font-size: clamp(14px,2vw,18px); max-width:980px;" class="svelte-9jfjg4">Marca las acciones que ya has abordado en tu proyecto.</p> <!> <div class="summary svelte-9jfjg4"> </div> <nav class="actions svelte-9jfjg4"><button class="back svelte-9jfjg4" type="button" aria-label="Volver"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="svelte-9jfjg4"><path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="svelte-9jfjg4"></path></svg></button> <button class="cta svelte-9jfjg4" type="button">Continuar</button></nav>`,1),aa=h('<section class="screen svelte-9jfjg4"><!></section>');function ua(ne,ve){Le(ve,!1);const Q=()=>Ne(Ue,"$page",ce),[ce,pe]=Je(),O=u();let p=u({nombre:"",descripcion:"",pilares:[]}),y=u([]),M=u(!0),V=u(""),A=u({comp:0,total:0}),X=u(0);ze(async()=>{try{const s=await fetch(`${le}/evaluaciones/${e(O)}/checklist`);if(!s.ok)throw new Error(await s.text());c(p,await s.json()),c(y,e(p).pilares??[])}catch(s){c(V,s.message)}finally{c(M,!1)}});const Y=["Verificando fuentes…","Midiendo impacto y riesgos…","Buscando sesgos…","Revisando transparencia y trazabilidad…","Organizando preguntas del pilar actual…"];let k=u(0),B=u(0),m=u(null);Ee(()=>{e(m)&&clearInterval(e(m))});function de(s,l,f){const _=e(y).find(n=>n.id===s);if(!_)return;const w=_.preguntas.find(n=>n.id===l);w&&(w.completada=f,fetch(`${le}/evaluaciones/${e(O)}/preguntas/${l}`,{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify({completada:f,notas:w.notas??""})}).then(n=>{if(n.ok)c(y,[...e(y)]);else throw new Error("Error actualizando pregunta")}).catch(()=>{}))}function fe(){history.back()}function ge(){window.location.href=`${We}/evaluaciones/${e(O)}/resultados`}T(()=>Q(),()=>{c(O,Q().params.id)}),T(()=>e(y),()=>{const s=e(y).flatMap(l=>l.preguntas);c(A,{comp:s.filter(l=>l.completada).length,total:s.length}),c(X,s.reduce((l,f)=>l+(f.completada?f.puntos:0),0))}),T(()=>(e(M),e(m),e(k),e(B)),()=>{e(M)&&!e(m)&&(c(k,0),c(B,0),c(m,setInterval(()=>{c(k,Math.min(95,e(k)+Math.ceil(Math.random()*7))),c(B,(e(B)+1)%Y.length)},600)))}),T(()=>(e(M),e(m)),()=>{!e(M)&&e(m)&&(clearInterval(e(m)),c(m,null),c(k,100))}),Ae(),Fe();var F=aa(),je=t(F);{var ue=s=>{var l=He(),f=t(l),_=r(t(f),2),w=t(_);a(_);var n=r(_,2),j=t(n),$=t(j);a(j);var J=r(j);a(n),a(f);var z=r(f,2);H(z,4,()=>Array(3),K,(I,Z)=>{var R=Ge();d(I,R)}),a(z),a(l),b(()=>{Oe(_,"aria-valuenow",e(k)),Ve(w,`width:${e(k)}%`),g($,`${e(k)??""}%`),g(J,` · ${e(B),i(()=>Y[e(B)])??""}`)}),d(s,l)},he=s=>{var l=Pe(),f=ie(l);{var _=n=>{var j=Ke(),$=t(j,!0);a(j),b(()=>g($,e(V))),d(n,j)},w=n=>{var j=ea(),$=ie(j),J=t($);J.textContent="Evaluación ética inicial",a($);var z=r($,2),I=t(z),Z=t(I,!0);a(I);var R=r(I,2);{var me=x=>{var o=Qe(),C=r(t(o));a(o),b(()=>g(C,` ${e(p),i(()=>e(p).etapa)??""}`)),d(x,o)};L(R,x=>{e(p),i(()=>e(p).etapa)&&x(me)})}var _e=r(R,2);{var xe=x=>{var o=Xe(),C=r(t(o));a(o),b(()=>g(C,` ${e(p),i(()=>e(p).descripcion)??""}`)),d(x,o)};L(_e,x=>{e(p),i(()=>e(p).descripcion)&&x(xe)})}a(z);var q=r(z,8);H(q,1,()=>e(y),K,(x,o)=>{var C=qe(),U=t(C),ye=t(U,!0);a(U);var te=r(U,2);{var we=P=>{var v=Ye(),E=t(v,!0);a(v),b(()=>g(E,(e(o),i(()=>e(o).descripcion)))),d(P,v)};L(te,P=>{e(o),i(()=>e(o).descripcion)&&P(we)})}var se=r(te,2);H(se,5,()=>(e(o),i(()=>e(o).preguntas)),K,(P,v)=>{var E=Ze(),S=t(E);Re(S);var W=r(S,4),$e=t(W,!0);a(W);var re=r(W,2),oe=t(re);{var Ce=D=>{var Be=De("Crítica ·");d(D,Be)};L(oe,D=>{e(v),i(()=>e(v).critica)&&D(Ce)})}var Me=r(oe);a(re),a(E),b(()=>{Te(E,1,`q ${e(v),i(()=>e(v).completada?"done":"")??""}`,"svelte-9jfjg4"),Se(S,(e(v),i(()=>e(v).completada))),g($e,(e(v),i(()=>e(v).texto))),g(Me,`${e(v),i(()=>e(v).puntos)??""}p`)}),G("change",S,D=>de(e(o).id,e(v).id,D.currentTarget.checked)),d(P,E)}),a(se),a(C),b(()=>g(ye,(e(o),i(()=>e(o).nombre)))),d(x,C)});var N=r(q,2),ke=t(N);a(N);var ee=r(N,2),ae=t(ee),be=r(ae,2);a(ee),b(()=>{g(Z,(e(p),i(()=>e(p).nombre))),g(ke,`Progreso: ${e(A),i(()=>e(A).comp)??""}/${e(A),i(()=>e(A).total)??""} · Puntos: ${e(X)??""}`)}),G("click",ae,fe),G("click",be,ge),d(n,j)};L(f,n=>{e(V)?n(_):n(w,!1)},!0)}d(s,l)};L(je,s=>{e(M)?s(ue):s(he,!1)})}a(F),d(ne,F),Ie(),pe()}export{ua as component};
