import"../chunks/DsnmJJEf.js";import"../chunks/D_JxtCvG.js";import{o as Ee,a as Le}from"../chunks/B9ntrt2Q.js";import{aE as ze,aF as S,aG as Ie,aH as m,a as d,aI as Pe,b as e,O as u,s as v,aK as t,aL as a,aJ as r,aM as b,u as i,c as Ae,f as ie,aO as Oe}from"../chunks/H9qgBCyD.js";import{s as g}from"../chunks/DflrDu60.js";import{i as z}from"../chunks/CoHz1Npk.js";import{e as N,i as U}from"../chunks/Cg6mc7CJ.js";import{s as De,r as Je,a as Re}from"../chunks/CsChzsNn.js";import{s as Se}from"../chunks/CkCo88cb.js";import{e as W}from"../chunks/CV5asq_h.js";import{s as Te}from"../chunks/DhZQgohg.js";import{i as Ve}from"../chunks/CQ-KNpQv.js";import{s as Fe,a as Ge}from"../chunks/WMH0LpM1.js";import{p as He}from"../chunks/CGGc3lc4.js";import{b as Ke}from"../chunks/D73iepPs.js";import{A as le}from"../chunks/gz7YWXWY.js";var Ne=m('<div class="skeletonCard svelte-9jfjg4"><span class="skDot svelte-9jfjg4"></span> <div class="skLines svelte-9jfjg4"><span class="skLine svelte-9jfjg4"></span> <span class="skLine short svelte-9jfjg4"></span></div> <span class="skBadge svelte-9jfjg4"></span></div>'),Ue=m('<section class="loadingWrap svelte-9jfjg4" aria-busy="true" aria-live="polite"><div class="loader svelte-9jfjg4"><div class="pill svelte-9jfjg4"><svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true" class="svelte-9jfjg4"><path d="M20 6L9 17l-5-5" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svelte-9jfjg4"></path></svg> <span class="orbit svelte-9jfjg4"></span></div> <div class="progress svelte-9jfjg4" role="progressbar" aria-valuemin="0" aria-valuemax="100"><div class="bar svelte-9jfjg4"></div></div> <div class="tip svelte-9jfjg4"><strong class="svelte-9jfjg4"> </strong> </div></div> <div class="skeletonList svelte-9jfjg4"></div></section>'),We=m('<p class="error svelte-9jfjg4"> </p>'),Qe=m('<p style="margin:0; color:var(--muted); font-size:14px" class="svelte-9jfjg4"><strong class="svelte-9jfjg4">Etapa:</strong> </p>'),Xe=m('<p style="margin:0 0 6px; color:var(--muted)" class="svelte-9jfjg4"><strong class="svelte-9jfjg4">Descripción:</strong> </p>'),Ye=m('<p class="pilar-desc svelte-9jfjg4"> </p>'),Ze=m('<label><input class="check svelte-9jfjg4" type="checkbox"/> <span class="tick svelte-9jfjg4" aria-hidden="true"><svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" class="svelte-9jfjg4"><path d="M20 6L9 17l-5-5" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svelte-9jfjg4"></path></svg></span> <span class="qtext svelte-9jfjg4"> </span> <span class="meta svelte-9jfjg4"><!> </span></label>'),qe=m('<section class="pilar svelte-9jfjg4"><h2 class="pilar-title svelte-9jfjg4"> </h2> <!> <div class="list svelte-9jfjg4"></div></section>'),ea=m(`<header class="heading svelte-9jfjg4"><h1 class="svelte-9jfjg4"></h1></header> <div class="card svelte-9jfjg4" style="max-width:980px; margin:0 auto 20px; padding:16px;"><h2 style="margin:0 0 6px" class="svelte-9jfjg4"> </h2> <!> <!></div> <hr class="svelte-9jfjg4"/> <h1 style="text-align:center; margin: 20px auto 10px; font-size: clamp(20px,4vw,32px); max-width:980px;" class="svelte-9jfjg4">Checklist de Principios</h1> <p style="text-align:center; margin:0 auto 24px; color:
            var(--muted); font-size: clamp(14px,2vw,18px); max-width:980px;" class="svelte-9jfjg4">Marca las acciones que ya has abordado en tu proyecto.</p> <!> <div class="summary svelte-9jfjg4"> </div> <nav class="actions svelte-9jfjg4"><button class="back svelte-9jfjg4" type="button" aria-label="Volver"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="svelte-9jfjg4"><path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="svelte-9jfjg4"></path></svg></button> <button class="cta svelte-9jfjg4" type="button">Continuar</button></nav>`,1),aa=m('<section class="screen svelte-9jfjg4"><!></section>');function ha(ne,ce){ze(ce,!1);const Q=()=>Ge(He,"$page",ve),[ve,pe]=Fe(),D=u();let p=u({nombre:"",descripcion:"",pilares:[]}),y=u([]),C=u(!0),T=u(""),I=u({comp:0,total:0}),X=u(0);Ee(async()=>{try{const s=await fetch(`${le}/evaluaciones/${e(D)}/checklist`);if(!s.ok)throw new Error(await s.text());v(p,await s.json()),v(y,e(p).pilares??[])}catch(s){v(T,s.message)}finally{v(C,!1)}});const Y=["Verificando fuentes…","Midiendo impacto y riesgos…","Buscando sesgos…","Revisando transparencia y trazabilidad…","Organizando preguntas del pilar actual…"];let k=u(0),B=u(0),h=u(null);Le(()=>{e(h)&&clearInterval(e(h))});function de(s,l,f){const _=e(y).find(n=>n.id===s);if(!_)return;const w=_.preguntas.find(n=>n.id===l);w&&(w.completada=f,fetch(`${le}/evaluaciones/${e(D)}/preguntas/${l}`,{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify({completada:f,notas:w.notas??""})}).then(n=>{if(n.ok)v(y,[...e(y)]);else throw new Error("Error actualizando pregunta")}).catch(()=>{}))}function fe(){history.back()}function ge(){window.location.href=`${Ke}/evaluaciones/${e(D)}/resultados`}S(()=>Q(),()=>{v(D,Q().params.id)}),S(()=>e(y),()=>{const s=e(y).flatMap(l=>l.preguntas);v(I,{comp:s.filter(l=>l.completada).length,total:s.length}),v(X,s.reduce((l,f)=>l+(f.completada?f.puntos:0),0))}),S(()=>(e(C),e(h),e(k),e(B)),()=>{e(C)&&!e(h)&&(v(k,0),v(B,0),v(h,setInterval(()=>{v(k,Math.min(95,e(k)+Math.ceil(Math.random()*7))),v(B,(e(B)+1)%Y.length)},600)))}),S(()=>(e(C),e(h)),()=>{!e(C)&&e(h)&&(clearInterval(e(h)),v(h,null),v(k,100))}),Ie(),Ve();var V=aa(),je=t(V);{var ue=s=>{var l=Ue(),f=t(l),_=r(t(f),2),w=t(_);a(_);var n=r(_,2),j=t(n),$=t(j);a(j);var F=r(j);a(n),a(f);var E=r(f,2);N(E,4,()=>Array(3),U,(P,Z)=>{var J=Ne();d(P,J)}),a(E),a(l),b(()=>{De(_,"aria-valuenow",e(k)),Te(w,`width:${e(k)}%`),g($,`${e(k)??""}%`),g(F,` · ${e(B),i(()=>Y[e(B)])??""}`)}),d(s,l)},me=s=>{var l=Ae(),f=ie(l);{var _=n=>{var j=We(),$=t(j,!0);a(j),b(()=>g($,e(T))),d(n,j)},w=n=>{var j=ea(),$=ie(j),F=t($);F.textContent="Evaluación ética inicial",a($);var E=r($,2),P=t(E),Z=t(P,!0);a(P);var J=r(P,2);{var he=x=>{var o=Qe(),M=r(t(o));a(o),b(()=>g(M,` ${e(p),i(()=>e(p).etapa)??""}`)),d(x,o)};z(J,x=>{e(p),i(()=>e(p).etapa)&&x(he)})}var _e=r(J,2);{var xe=x=>{var o=Xe(),M=r(t(o));a(o),b(()=>g(M,` ${e(p),i(()=>e(p).descripcion)??""}`)),d(x,o)};z(_e,x=>{e(p),i(()=>e(p).descripcion)&&x(xe)})}a(E);var q=r(E,8);N(q,1,()=>e(y),U,(x,o)=>{var M=qe(),H=t(M),ye=t(H,!0);a(H);var te=r(H,2);{var we=A=>{var c=Ye(),L=t(c,!0);a(c),b(()=>g(L,(e(o),i(()=>e(o).descripcion)))),d(A,c)};z(te,A=>{e(o),i(()=>e(o).descripcion)&&A(we)})}var se=r(te,2);N(se,5,()=>(e(o),i(()=>e(o).preguntas)),U,(A,c)=>{var L=Ze(),R=t(L);Je(R);var K=r(R,4),$e=t(K,!0);a(K);var re=r(K,2),oe=t(re);{var Me=O=>{var Be=Oe("Crítica ·");d(O,Be)};z(oe,O=>{e(c),i(()=>e(c).critica)&&O(Me)})}var Ce=r(oe);a(re),a(L),b(()=>{Se(L,1,`q ${e(c),i(()=>e(c).completada?"done":"")??""}`,"svelte-9jfjg4"),Re(R,(e(c),i(()=>e(c).completada))),g($e,(e(c),i(()=>e(c).texto))),g(Ce,`${e(c),i(()=>e(c).puntos)??""}p`)}),W("change",R,O=>de(e(o).id,e(c).id,O.currentTarget.checked)),d(A,L)}),a(se),a(M),b(()=>g(ye,(e(o),i(()=>e(o).nombre)))),d(x,M)});var G=r(q,2),ke=t(G);a(G);var ee=r(G,2),ae=t(ee),be=r(ae,2);a(ee),b(()=>{g(Z,(e(p),i(()=>e(p).nombre))),g(ke,`Progreso: ${e(I),i(()=>e(I).comp)??""}/${e(I),i(()=>e(I).total)??""} · Puntos: ${e(X)??""}`)}),W("click",ae,fe),W("click",be,ge),d(n,j)};z(f,n=>{e(T)?n(_):n(w,!1)},!0)}d(s,l)};z(je,s=>{e(C)?s(ue):s(me,!1)})}a(V),d(ne,V),Pe(),pe()}export{ha as component};
