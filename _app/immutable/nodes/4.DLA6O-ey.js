import"../chunks/DsnmJJEf.js";import"../chunks/DPrBCdru.js";import{o as Ee,a as Le}from"../chunks/Cyriu56C.js";import{aE as ze,aF as T,aG as Ie,aH as m,a as d,aI as Pe,b as e,r as u,s as v,aK as t,aL as a,aJ as r,aM as k,u as i,c as Ae,f as ne,aO as De}from"../chunks/neBeJoSk.js";import{s as f}from"../chunks/eGiiCsl1.js";import{i as I}from"../chunks/D063bcsz.js";import{e as U,i as W}from"../chunks/CPOY0O8l.js";import{s as Oe,r as Se,a as Je}from"../chunks/DcqV7Q3_.js";import{s as Re}from"../chunks/DIAVctrH.js";import{e as Q}from"../chunks/C0dDduxs.js";import{s as Te}from"../chunks/BIdJ622x.js";import{i as Ve}from"../chunks/CapF0iNR.js";import{s as Fe,a as Ge}from"../chunks/DcK4b_8z.js";import{s as He}from"../chunks/D90t66Pw.js";import{b as Ke}from"../chunks/aGreL2Kf.js";import{A as ce}from"../chunks/gz7YWXWY.js";const Ne=()=>{const y=He;return{page:{subscribe:y.page.subscribe},navigating:{subscribe:y.navigating.subscribe},updated:y.updated}},Ue={subscribe(y){return Ne().page.subscribe(y)}};var We=m('<div class="skeletonCard svelte-9jfjg4"><span class="skDot svelte-9jfjg4"></span> <div class="skLines svelte-9jfjg4"><span class="skLine svelte-9jfjg4"></span> <span class="skLine short svelte-9jfjg4"></span></div> <span class="skBadge svelte-9jfjg4"></span></div>'),Qe=m('<section class="loadingWrap svelte-9jfjg4" aria-busy="true" aria-live="polite"><div class="loader svelte-9jfjg4"><div class="pill svelte-9jfjg4"><svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true" class="svelte-9jfjg4"><path d="M20 6L9 17l-5-5" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svelte-9jfjg4"></path></svg> <span class="orbit svelte-9jfjg4"></span></div> <div class="progress svelte-9jfjg4" role="progressbar" aria-valuemin="0" aria-valuemax="100"><div class="bar svelte-9jfjg4"></div></div> <div class="tip svelte-9jfjg4"><strong class="svelte-9jfjg4"> </strong> </div></div> <div class="skeletonList svelte-9jfjg4"></div></section>'),Xe=m('<p class="error svelte-9jfjg4"> </p>'),Ye=m('<p style="margin:0; color:var(--muted); font-size:14px" class="svelte-9jfjg4"><strong class="svelte-9jfjg4">Etapa:</strong> </p>'),Ze=m('<p style="margin:0 0 6px; color:var(--muted)" class="svelte-9jfjg4"><strong class="svelte-9jfjg4">Descripción:</strong> </p>'),qe=m('<p class="pilar-desc svelte-9jfjg4"> </p>'),ea=m('<label><input class="check svelte-9jfjg4" type="checkbox"/> <span class="tick svelte-9jfjg4" aria-hidden="true"><svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" class="svelte-9jfjg4"><path d="M20 6L9 17l-5-5" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svelte-9jfjg4"></path></svg></span> <span class="qtext svelte-9jfjg4"> </span> <span class="meta svelte-9jfjg4"><!> </span></label>'),aa=m('<section class="pilar svelte-9jfjg4"><h2 class="pilar-title svelte-9jfjg4"> </h2> <!> <div class="list svelte-9jfjg4"></div></section>'),ta=m(`<header class="heading svelte-9jfjg4"><h1 class="svelte-9jfjg4"></h1></header> <div class="card svelte-9jfjg4" style="max-width:980px; margin:0 auto 20px; padding:16px;"><h2 style="margin:0 0 6px" class="svelte-9jfjg4"> </h2> <!> <!></div> <hr class="svelte-9jfjg4"/> <h1 style="text-align:center; margin: 20px auto 10px; font-size: clamp(20px,4vw,32px); max-width:980px;" class="svelte-9jfjg4">Checklist de Principios</h1> <p style="text-align:center; margin:0 auto 24px; color:
            var(--muted); font-size: clamp(14px,2vw,18px); max-width:980px;" class="svelte-9jfjg4">Marca las acciones que ya has abordado en tu proyecto.</p> <!> <div class="summary svelte-9jfjg4"> </div> <nav class="actions svelte-9jfjg4"><button class="back svelte-9jfjg4" type="button" aria-label="Volver"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="svelte-9jfjg4"><path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="svelte-9jfjg4"></path></svg></button> <button class="cta svelte-9jfjg4" type="button">Continuar</button></nav>`,1),sa=m('<section class="screen svelte-9jfjg4"><!></section>');function xa(y,X){ze(X,!1);const Y=()=>Ge(Ue,"$page",ve),[ve,pe]=Fe(),S=u();let p=u({nombre:"",descripcion:"",pilares:[]}),w=u([]),B=u(!0),V=u(""),P=u({comp:0,total:0}),Z=u(0);Ee(async()=>{try{const s=await fetch(`${ce}/evaluaciones/${e(S)}/checklist`);if(!s.ok)throw new Error(await s.text());v(p,await s.json()),v(w,e(p).pilares??[])}catch(s){v(V,s.message)}finally{v(B,!1)}});const q=["Verificando fuentes…","Midiendo impacto y riesgos…","Buscando sesgos…","Revisando transparencia y trazabilidad…","Organizando preguntas del pilar actual…"];let b=u(0),E=u(0),h=u(null);Le(()=>{e(h)&&clearInterval(e(h))});function de(s,l,g){const _=e(w).find(n=>n.id===s);if(!_)return;const $=_.preguntas.find(n=>n.id===l);$&&($.completada=g,fetch(`${ce}/evaluaciones/${e(S)}/preguntas/${l}`,{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify({completada:g,notas:$.notas??""})}).then(n=>{if(n.ok)v(w,[...e(w)]);else throw new Error("Error actualizando pregunta")}).catch(()=>{}))}function ge(){history.back()}function fe(){window.location.href=`${Ke}/evaluaciones/${e(S)}/resultados`}T(()=>Y(),()=>{v(S,Y().params.id)}),T(()=>e(w),()=>{const s=e(w).flatMap(l=>l.preguntas);v(P,{comp:s.filter(l=>l.completada).length,total:s.length}),v(Z,s.reduce((l,g)=>l+(g.completada?g.puntos:0),0))}),T(()=>(e(B),e(h),e(b),e(E)),()=>{e(B)&&!e(h)&&(v(b,0),v(E,0),v(h,setInterval(()=>{v(b,Math.min(95,e(b)+Math.ceil(Math.random()*7))),v(E,(e(E)+1)%q.length)},600)))}),T(()=>(e(B),e(h)),()=>{!e(B)&&e(h)&&(clearInterval(e(h)),v(h,null),v(b,100))}),Ie(),Ve();var F=sa(),je=t(F);{var ue=s=>{var l=Qe(),g=t(l),_=r(t(g),2),$=t(_);a(_);var n=r(_,2),j=t(n),M=t(j);a(j);var G=r(j);a(n),a(g);var L=r(g,2);U(L,4,()=>Array(3),W,(A,ee)=>{var J=We();d(A,J)}),a(L),a(l),k(()=>{Oe(_,"aria-valuenow",e(b)),Te($,`width:${e(b)}%`),f(M,`${e(b)??""}%`),f(G,` · ${e(E),i(()=>q[e(E)])??""}`)}),d(s,l)},me=s=>{var l=Ae(),g=ne(l);{var _=n=>{var j=Xe(),M=t(j,!0);a(j),k(()=>f(M,e(V))),d(n,j)},$=n=>{var j=ta(),M=ne(j),G=t(M);G.textContent="Evaluación ética inicial",a(M);var L=r(M,2),A=t(L),ee=t(A,!0);a(A);var J=r(A,2);{var he=x=>{var o=Ye(),C=r(t(o));a(o),k(()=>f(C,` ${e(p),i(()=>e(p).etapa)??""}`)),d(x,o)};I(J,x=>{e(p),i(()=>e(p).etapa)&&x(he)})}var _e=r(J,2);{var xe=x=>{var o=Ze(),C=r(t(o));a(o),k(()=>f(C,` ${e(p),i(()=>e(p).descripcion)??""}`)),d(x,o)};I(_e,x=>{e(p),i(()=>e(p).descripcion)&&x(xe)})}a(L);var ae=r(L,8);U(ae,1,()=>e(w),W,(x,o)=>{var C=aa(),K=t(C),ye=t(K,!0);a(K);var re=r(K,2);{var we=D=>{var c=qe(),z=t(c,!0);a(c),k(()=>f(z,(e(o),i(()=>e(o).descripcion)))),d(D,c)};I(re,D=>{e(o),i(()=>e(o).descripcion)&&D(we)})}var oe=r(re,2);U(oe,5,()=>(e(o),i(()=>e(o).preguntas)),W,(D,c)=>{var z=ea(),R=t(z);Se(R);var N=r(R,4),$e=t(N,!0);a(N);var ie=r(N,2),le=t(ie);{var Me=O=>{var Be=De("Crítica ·");d(O,Be)};I(le,O=>{e(c),i(()=>e(c).critica)&&O(Me)})}var Ce=r(le);a(ie),a(z),k(()=>{Re(z,1,`q ${e(c),i(()=>e(c).completada?"done":"")??""}`,"svelte-9jfjg4"),Je(R,(e(c),i(()=>e(c).completada))),f($e,(e(c),i(()=>e(c).texto))),f(Ce,`${e(c),i(()=>e(c).puntos)??""}p`)}),Q("change",R,O=>de(e(o).id,e(c).id,O.currentTarget.checked)),d(D,z)}),a(oe),a(C),k(()=>f(ye,(e(o),i(()=>e(o).nombre)))),d(x,C)});var H=r(ae,2),be=t(H);a(H);var te=r(H,2),se=t(te),ke=r(se,2);a(te),k(()=>{f(ee,(e(p),i(()=>e(p).nombre))),f(be,`Progreso: ${e(P),i(()=>e(P).comp)??""}/${e(P),i(()=>e(P).total)??""} · Puntos: ${e(Z)??""}`)}),Q("click",se,ge),Q("click",ke,fe),d(n,j)};I(g,n=>{e(V)?n(_):n($,!1)},!0)}d(s,l)};I(je,s=>{e(B)?s(ue):s(me,!1)})}a(F),d(y,F),Pe(),pe()}export{xa as component};
