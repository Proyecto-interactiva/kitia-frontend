import"../chunks/DsnmJJEf.js";import"../chunks/Co3yc64f.js";import{o as fa}from"../chunks/DxZOmja6.js";import{am as ua,aT as ga,aU as ma,an as u,a as l,aq as _a,G as a,X as k,I as w,ao as i,ar as s,as as o,c as ba,f as L,ap as T,j as r}from"../chunks/tjmoeONZ.js";import{s as f}from"../chunks/r1iMuBZ-.js";import{i as D}from"../chunks/9jrT_3zx.js";import{e as Q,i as R}from"../chunks/DRDXhByV.js";import{r as ha,a as ja}from"../chunks/VJiT-DM5.js";import{e as W}from"../chunks/C-MdJe_B.js";import{i as xa}from"../chunks/8ghubDwy.js";import{s as $a,a as ya}from"../chunks/BySM2QB6.js";import{s as ka}from"../chunks/B8CkxEAH.js";import{b as wa}from"../chunks/BsRvJaks.js";const Ta=()=>{const v=ka;return{page:{subscribe:v.page.subscribe},navigating:{subscribe:v.navigating.subscribe},updated:v.updated}},Ea={subscribe(v){return Ta().page.subscribe(v)}};var Ma=u("<p>Cargando checklist…</p>"),Pa=u('<p style="color:#b91c1c"> </p>'),Ca=u('<span class="critica svelte-9jfjg4">Crítica</span>'),Ia=u('<div class="pregunta svelte-9jfjg4"><label style="display:flex;align-items:center;"><input type="checkbox" class="checkbox svelte-9jfjg4"/> <span> </span> <!> <span class="badge svelte-9jfjg4"> </span></label></div>'),Sa=u('<div class="card svelte-9jfjg4"><div class="pilar-title svelte-9jfjg4"> <span class="badge svelte-9jfjg4"> </span></div> <p style="font-size:13px;color:#6b7280;margin-bottom:12px"> </p> <!></div>'),Ua=u('<div class="progreso svelte-9jfjg4"><div> </div></div> <button class="btn" style="background:#4338ca;color:#fff;border:none;cursor:pointer;">Ver resultados</button> <!>',1),za=u('<div class="container svelte-9jfjg4"><h1>Evaluación Ética</h1> <!></div>');function Qa(v,G){ua(G,!1);const J=()=>ya(Ea,"$page",Y),[Y,Z]=$a(),$=k();let g=k([]),N=k(!0),E=k("");fa(async()=>{try{const t=await fetch(`/api/evaluaciones/${a($)}/checklist`);if(!t.ok)throw new Error(await t.text());w(g,await t.json()),console.log(a(g)),console.log("Evaluacion ID:",t)}catch(t){w(E,t.message)}finally{w(N,!1)}});function q(t,n){const p=a(g).find(b=>b.id===t);if(!p)return;const d=p.preguntas.find(b=>b.id===n);d&&(d.completada=!d.completada,fetch(`/api/evaluaciones/${a($)}/preguntas/${n}`,{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify({completada:d.completada,notas:d.notas??""})}))}function O(){const t=a(g).flatMap(p=>p.preguntas);return{comp:t.filter(p=>p.completada).length,total:t.length}}function aa(){return a(g).flatMap(t=>t.preguntas).reduce((t,n)=>t+(n.completada?n.puntos:0),0)}ga(()=>J(),()=>{w($,J().params.id)}),ma(),xa();var M=za(),ta=i(s(M),2);{var ea=t=>{var n=Ma();l(t,n)},sa=t=>{var n=ba(),p=L(n);{var d=m=>{var _=Pa(),h=s(_,!0);o(_),T(()=>f(h,a(E))),l(m,_)},b=m=>{var _=Ua(),h=L(_),V=s(h),oa=s(V);o(V),o(h);var X=i(h,2),ra=i(X,2);Q(ra,1,()=>a(g),R,(P,e)=>{var j=Sa(),C=s(j),A=s(C),B=i(A),na=s(B);o(B),o(C);var I=i(C,2),ca=s(I,!0);o(I);var ia=i(I,2);Q(ia,1,()=>(a(e),r(()=>a(e).preguntas)),R,(x,c)=>{var S=Ia(),F=s(S),y=s(F);ha(y);var U=i(y,2),pa=s(U,!0);o(U);var H=i(U,2);{var la=z=>{var da=Ca();l(z,da)};D(H,z=>{a(c),r(()=>a(c).critica)&&z(la)})}var K=i(H,2),va=s(K);o(K),o(F),o(S),T(()=>{ja(y,(a(c),r(()=>a(c).completada))),f(pa,(a(c),r(()=>a(c).texto))),f(va,`${a(c),r(()=>a(c).puntos)??""} pts`)}),W("change",y,()=>q(a(e).id,a(c).id)),l(x,S)}),o(j),T(x=>{f(A,`${a(e),r(()=>a(e).nombre)??""} `),f(na,`${x??""}/${a(e),r(()=>a(e).preguntas.length)??""}`),f(ca,(a(e),r(()=>a(e).descripcion)))},[()=>(a(e),r(()=>a(e).preguntas.filter(x=>x.completada).length))]),l(P,j)}),T((P,e,j)=>f(oa,`Progreso: ${P??""} de ${e??""} preguntas · Puntos: ${j??""}`),[()=>r(()=>O().comp),()=>r(()=>O().total),()=>r(aa)]),W("click",X,()=>window.location.href=`${wa}/evaluaciones/${a($)}/resultados`),l(m,_)};D(p,m=>{a(E)?m(d):m(b,!1)},!0)}l(t,n)};D(ta,t=>{a(N)?t(ea):t(sa,!1)})}o(M),l(v,M),_a(),Z()}export{Qa as component};
