import"../chunks/DsnmJJEf.js";import"../chunks/Co3yc64f.js";import{o as fa}from"../chunks/DxZOmja6.js";import{am as ua,aT as ga,aU as ma,an as u,a as p,aq as _a,G as a,X as k,I as w,ao as i,ar as s,as as o,c as ba,f as L,ap as T,j as r}from"../chunks/tjmoeONZ.js";import{s as f}from"../chunks/r1iMuBZ-.js";import{i as D}from"../chunks/9jrT_3zx.js";import{e as Q,i as R}from"../chunks/DRDXhByV.js";import{r as ha,a as ja}from"../chunks/VJiT-DM5.js";import{e as W}from"../chunks/C-MdJe_B.js";import{i as xa}from"../chunks/8ghubDwy.js";import{s as ya,a as $a}from"../chunks/BySM2QB6.js";import{s as ka}from"../chunks/DgmG8f6d.js";const wa=()=>{const v=ka;return{page:{subscribe:v.page.subscribe},navigating:{subscribe:v.navigating.subscribe},updated:v.updated}},Ta={subscribe(v){return wa().page.subscribe(v)}};var Ea=u("<p>Cargando checklist…</p>"),Ma=u('<p style="color:#b91c1c"> </p>'),Pa=u('<span class="critica svelte-9jfjg4">Crítica</span>'),Ca=u('<div class="pregunta svelte-9jfjg4"><label style="display:flex;align-items:center;"><input type="checkbox" class="checkbox svelte-9jfjg4"/> <span> </span> <!> <span class="badge svelte-9jfjg4"> </span></label></div>'),Ia=u('<div class="card svelte-9jfjg4"><div class="pilar-title svelte-9jfjg4"> <span class="badge svelte-9jfjg4"> </span></div> <p style="font-size:13px;color:#6b7280;margin-bottom:12px"> </p> <!></div>'),Sa=u('<div class="progreso svelte-9jfjg4"><div> </div></div> <button class="btn" style="background:#4338ca;color:#fff;border:none;cursor:pointer;">Ver resultados</button> <!>',1),Ua=u('<div class="container svelte-9jfjg4"><h1>Evaluación Ética</h1> <!></div>');function Ka(v,G){ua(G,!1);const J=()=>$a(Ta,"$page",Y),[Y,Z]=ya(),y=k();let g=k([]),N=k(!0),E=k("");fa(async()=>{try{const t=await fetch(`/api/evaluaciones/${a(y)}/checklist`);if(!t.ok)throw new Error(await t.text());w(g,await t.json()),console.log(a(g)),console.log("Evaluacion ID:",t)}catch(t){w(E,t.message)}finally{w(N,!1)}});function q(t,n){const l=a(g).find(b=>b.id===t);if(!l)return;const d=l.preguntas.find(b=>b.id===n);d&&(d.completada=!d.completada,fetch(`/api/evaluaciones/${a(y)}/preguntas/${n}`,{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify({completada:d.completada,notas:d.notas??""})}))}function O(){const t=a(g).flatMap(l=>l.preguntas);return{comp:t.filter(l=>l.completada).length,total:t.length}}function aa(){return a(g).flatMap(t=>t.preguntas).reduce((t,n)=>t+(n.completada?n.puntos:0),0)}ga(()=>J(),()=>{w(y,J().params.id)}),ma(),xa();var M=Ua(),ta=i(s(M),2);{var ea=t=>{var n=Ea();p(t,n)},sa=t=>{var n=ba(),l=L(n);{var d=m=>{var _=Ma(),h=s(_,!0);o(_),T(()=>f(h,a(E))),p(m,_)},b=m=>{var _=Sa(),h=L(_),V=s(h),oa=s(V);o(V),o(h);var X=i(h,2),ra=i(X,2);Q(ra,1,()=>a(g),R,(P,e)=>{var j=Ia(),C=s(j),A=s(C),B=i(A),na=s(B);o(B),o(C);var I=i(C,2),ca=s(I,!0);o(I);var ia=i(I,2);Q(ia,1,()=>(a(e),r(()=>a(e).preguntas)),R,(x,c)=>{var S=Ca(),F=s(S),$=s(F);ha($);var U=i($,2),la=s(U,!0);o(U);var H=i(U,2);{var pa=z=>{var da=Pa();p(z,da)};D(H,z=>{a(c),r(()=>a(c).critica)&&z(pa)})}var K=i(H,2),va=s(K);o(K),o(F),o(S),T(()=>{ja($,(a(c),r(()=>a(c).completada))),f(la,(a(c),r(()=>a(c).texto))),f(va,`${a(c),r(()=>a(c).puntos)??""} pts`)}),W("change",$,()=>q(a(e).id,a(c).id)),p(x,S)}),o(j),T(x=>{f(A,`${a(e),r(()=>a(e).nombre)??""} `),f(na,`${x??""}/${a(e),r(()=>a(e).preguntas.length)??""}`),f(ca,(a(e),r(()=>a(e).descripcion)))},[()=>(a(e),r(()=>a(e).preguntas.filter(x=>x.completada).length))]),p(P,j)}),T((P,e,j)=>f(oa,`Progreso: ${P??""} de ${e??""} preguntas · Puntos: ${j??""}`),[()=>r(()=>O().comp),()=>r(()=>O().total),()=>r(aa)]),W("click",X,()=>window.location.href=`/evaluaciones/${a(y)}/resultados`),p(m,_)};D(l,m=>{a(E)?m(d):m(b,!1)},!0)}p(t,n)};D(ta,t=>{a(N)?t(ea):t(sa,!1)})}o(M),p(v,M),_a(),Z()}export{Ka as component};
